__d(function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CUSTOM_METRICS=void 0,e.customMetricTimerStart=t,e.useCustomMetrics=function(){return{customMetricsMapping:n,customMetricMarkEnd:(0,_.useCallback)(o,[]),customMetricTimerStart:(0,_.useCallback)(t,[]),customMetricTimerEnd:(0,_.useCallback)(c,[])}};var _=r(d[0]);const n=e.CUSTOM_METRICS={Home:{time_to_search_rendered:'time_to_search_rendered',time_to_icon_video_rendered:'time_to_icon_video_rendered',time_to_icon_video_canplaythrough:'time_to_icon_video_canplaythrough',time_to_icon_lava_rendered:'time_to_icon_lava_rendered',time_to_icon_lava_canplaythrough:'time_to_icon_lava_canplaythrough',duration_experiences_nux_viewed:'duration_experiences_nux_viewed',duration_services_nux_viewed:'duration_services_nux_viewed',time_to_signup_and_login_modal_render:'time_to_signup_and_login_modal_render'},PdpHomeMarketplace:{time_to_signup_and_login_modal_render:'time_to_signup_and_login_modal_render'},SearchResults:{time_to_signup_and_login_modal_render:'time_to_signup_and_login_modal_render'},CheckoutHome:{time_to_signup_and_login_modal_render:'time_to_signup_and_login_modal_render'},WishListDetail:{time_to_signup_and_login_modal_render:'time_to_signup_and_login_modal_render'},WishListsList:{time_to_signup_and_login_modal_render:'time_to_signup_and_login_modal_render'}};function o(_){window.performance.mark(`${_}_end`)}function t(_){window.performance.mark(`${_}_start`)}function c(_){window.performance.mark(`${_}_end`)}},"053d33",["07aa1f"]);
__d(function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.updateCache=void 0;var n=t(r(d[1])),o=r(d[2]);const u=(t,n)=>{if(n&&t?.paymentDataRequest){const u=JSON.parse(t.paymentDataRequest),s=JSON.stringify((0,o.convertToStableObjectOrder)({...u,bill_info:{...u?.bill_info,bill_item_product_id:n}}));return{...t,paymentDataRequest:s}}return t};e.updateCache=({proxy:t,stayCheckout:o,variables:s})=>{const c=o?.sections?.metadata?.confirmationCode||void 0,p=u(s?.input?.quickPayData,c),l={input:{...s.input,confirmationCode:c,quickPayData:p}};t.unsafe__writeQuery({query:n.default,variables:l,data:{presentation:{__typename:'RootPresentationContainer',stayCheckout:o}}})}},"3a7831",["ba7a76","54d6bb","f82df7"]);
__d(function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default,o=r(d[1]).default;function s(){const t=r(d[2]);return s=function(){return t},t}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,e.mutateSearchWithParams=T;var n=r(d[3]),u=r(d[4]),c=r(d[5]),f=r(d[6]),y=r(d[7]),C=o(r(d[8]));function l(){const t=r(d[9]);return l=function(){return t},t}var h=r(d[10]),p=t(r(d[11])),_=t(r(d[12])),k=r(d[13]),v=t(r(d[14])),b=t(r(d[15])),O=t(r(d[16])),M=r(d[17]),P=r(d[18]),I=r(d[19]),R=r(d[20]);function T({confirmationCode:t,orderId:o,params:n,staysData:c}){const f=b.default.current().curr,{numberOfGuests:C,guestCurrency:l}=n;l&&l!==f&&(0,u.airdogCount)('checkout_web_create_route.currency_mismatch',1,{url_currency:l,user_currency:f});const h={...n,code:t,orderId:o,guestCurrency:l||f||void 0};if(!(void 0!==C||!c)){const{numberOfAdults:t,numberOfChildren:o,numberOfGuests:n,numberOfInfants:u,numberOfPets:f}=c||{},C={numberOfAdults:t??void 0,numberOfChildren:o??void 0,numberOfGuests:n??void 0,numberOfInfants:u??void 0,numberOfPets:f??void 0,...h};return(0,y.warn)('[Checkout][Stays] create route recovery flow triggered',{extra:{updatedParams:h,staysData:c}}),`?${(0,s().stringify)(C)}`}return`?${(0,s().stringify)(h)}`}const S=(0,p.default)({universalPageName:4003,includeHistoryUpdate:()=>!1,customMetricMapping:h.CUSTOM_METRICS.CheckoutHome})(({location:t,queryRef:o})=>{const y=(0,l().useNiobeClient)(),{search:h}=t,p=(0,n.useMemo)(()=>(0,c.coerceStaysCheckoutParams)((0,_.default)(h)),[h]),{productId:b}=p,S=(0,C.default)()===C.FORM_FACTOR.COMPACT,{data:$,error:x}=(0,l().usePreloadedQuery)({query:O.default,queryRef:o});return b||(0,P.reportStaysCheckoutInputError)(p,'StaysCheckoutCreateRoute_mutation'),(0,n.useEffect)(()=>{const t=$?.presentation?.stayCheckout?.sections?.metadata?.clientLoggingContext?.staysData?.checkoutProductVersion||null;(0,u.airdogCount)('checkout.stays.route.first_render',1,{has_data:!!$,route:'stays_create_route',is_compact:S,checkout_prefetch_on_hover_v2:!S||'compact',product_version:t})},[]),(0,n.useEffect)(()=>{const o=$?.presentation?.stayCheckout?.sections?.metadata?.checkoutFlowMetadata;if((0,f.shouldRedirectToLogin)(o)){(0,u.airdogCount)('stays_checkout.create_route.bot_detection_redirect',1);const o=(0,f.buildLoginRedirectUrl)(t.pathname,t.search);return void(0,k.replaceToHistory)(o)}if((x||$?.presentation?.stayCheckout?.sections?.metadata?.clientLoggingContext?.errorCode||$?.presentation?.stayCheckout?.sections?.metadata?.errorData)&&(0,u.airdogCount)('stays_checkout.create_route.error',1,{errorCode:$?.presentation?.stayCheckout?.sections?.metadata?.clientLoggingContext?.errorCode,niobeError:x?.message,hasRedirect:!!$?.presentation?.stayCheckout?.sections?.metadata?.errorData?.redirectUrl}),$?.presentation?.stayCheckout){const{stayCheckout:t}=$.presentation,o=t.sections?.metadata?.orderId||void 0,s=T({confirmationCode:t.sections?.metadata?.confirmationCode||void 0,orderId:o,params:p,staysData:t.sections?.stateMutation||void 0}),n=(0,I.getCheckoutPrepareMutationVariables)({params:{...p,orderId:o}});(0,M.updateCache)({proxy:y,stayCheckout:t,variables:n}),(0,k.replaceToHistory)(`/book/stays/${b}${s}`)}else{const t=`?${(0,s().stringify)(p)}`;(0,k.replaceToHistory)(`/book/stays/${b}${t}`)}},[$,x,b,p,y,S,t]),(0,R.jsx)(v.default,{})});e.default=S},"8ffd6d",["ba7a76","45f788","e950a3","07aa1f","3e4681","068d42","d1c6ab","f2f40f","e0b071","068abc","053d33","3a6fa9","a7c4ef","4ee5a9","f27cf8","06a99e","54d6bb","3a7831","ec8c71","6c477c","b8c07d"]);
__d(function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.buildLoginRedirectUrl=o,e.buildLoginRedirectUrlFromLocation=function(t){return o(t.pathname,t.search)},e.shouldRedirectToLogin=function(t){if(n.default.isLoggedIn())return!1;const o=t?.errorMetadata?.errorRedirect;return'CheckoutErrorRedirectSignupLogin'===o?.__typename};var n=t(r(d[1]));function o(t,n){return`/login?redirect_url=${encodeURIComponent(`${t}${n||''}`)}`}},"d1c6ab",["ba7a76","06a99e"]);
//# sourceMappingURL=https://sourcemaps.d.musta.ch/airbnb/static/packages/web/common/frontend/checkout-route-stays/routes/StaysCheckoutRoute/StaysCheckoutCreateRoute.0cf1dd375c.js.map