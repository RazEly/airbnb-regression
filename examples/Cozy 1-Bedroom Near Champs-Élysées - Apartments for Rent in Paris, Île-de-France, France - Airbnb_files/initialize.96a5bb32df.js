__d(function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.hasPermission=p,e.requestPermission=async function(){if(!(0,s.supportsPushNotifications)())return!1;if('denied'===Notification.permission)return!1;if('granted'===Notification.permission)return!0;f(()=>'Attempting to request permissions');const n=await Notification.requestPermission(),{datadogTags:o}=await(0,u.getInitializeOptions)();switch(f(()=>`Resulting permission: ${n}`),n){case'granted':(0,t.airdogCount)('service_worker.push_notifications.permission_granted',1,o);break;case'denied':(0,t.airdogCount)('service_worker.push_notifications.permission_denied',1,o);break;case'default':(0,t.airdogCount)('service_worker.push_notifications.permission_default',1,o)}return'granted'===n},e.shouldShowPushNotificationsOptIn=async function(){if(await c())return!1;if('undefined'==typeof Notification)return f(()=>'Not showing push notifications since they\u2019re not supported'),!1;if('denied'===Notification.permission)return f(()=>'Not showing push notifications due to not having permission'),!1;return!0};var t=r(d[0]),n=r(d[1]),o=r(d[2]),s=r(d[3]),u=r(d[4]);const f=(0,n.createLogger)('Push:Permissions',(0,n.createPrefixStyle)('#b95f6f','#fff'));async function c(){return!!p()&&(0,o.hasValidDeviceId)()}function p(){return'undefined'!=typeof Notification&&'granted'===Notification.permission}},"0a0e02",["3e4681","102445","e62feb","f09318","436356"]);
__d(function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.makeDatadogTags=function(o){let s='unknown';(0,n.isAndroid)()?s='android':(0,n.isIos)()&&(s='ios');const t=`os:${s}`,u=`browser:${(0,n.getUserAgentName)()}`;return[t,u,o].join(',')};var n=r(d[0])},"159ba6",["e9b7bf"]);
__d(function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=async function(t){const{tracking_context:c={}}=n.default.get('layout-init'),{appType:s}=await(0,p.getInitializeOptions)(),f=o.default.current().idStr,v=await(0,u.default)(f);if(!f)throw new Error('Cannot make a token without a valid userId.');return{appType:s,appVersion:`${c.controller}:${c.version}`,buildType:'RELEASE',deviceType:(0,l.default)(),deviceVersion:navigator.userAgent,nativeDeviceId:v,timeStamp:String((new Date).getTime()),token:JSON.stringify(t),tokenType:'VAPID',userId:-2}};var n=t(r(d[1])),o=t(r(d[2])),u=t(r(d[3])),l=t(r(d[4])),p=r(d[5])},"35b332",["ba7a76","ef2bc3","06a99e","e62feb","d93056","436356"]);
__d(function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.hasValidPushSubscription=async function(){const{serviceWorkerRegistration:s}=await(0,n.getInitializeOptions)();if(!await(0,t.hasValidDeviceId)())return!1;return!!await s.pushManager.getSubscription()};var t=r(d[0]),n=r(d[1])},"3d5c9c",["e62feb","436356"]);
__d(function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=function({datadogTags:t,niobeClient:n}){'undefined'!=typeof Notification&&'denied'===Notification.permission&&(0,o.airdogCount)('service_worker.push_permission_denied',1,t);if(v=t,h=n,_(),!(0,f.hasPermission)())return;try{if(!u.default.isLoggedIn())return void(0,p.clearSubscription)();(0,p.updateSubscriptionIfOptedIn)()}catch(t){(0,s.reportError)(t)}},e.getInitializeOptions=async function(){if('undefined'==typeof navigator||!navigator||!navigator.serviceWorker)throw new Error('Push notifications requires a service worker to be available.');const t=await navigator.serviceWorker.ready;if(!t||!t.active)throw new Error('No service worker was activated, push notifications are not available.');await Promise.race([w,c.scheduler.wait({delay:3e4})]);const{tracking_context:s}=n.default.get('layout-init'),{controller:u}=s,f='homes-host-loop'===u?'GLOBAL_HOST':'GLOBAL_TRAVEL',p=t.active.scriptURL.split('/'),_=`/${p[p.length-1]}`,y=(0,l.makeDatadogTags)(`registered_path:${_}`),k=v?[v,y].join(','):y;h||(0,o.airdogCount)('service_worker.push_initialize_timeout',1,k);return{datadogTags:k,appType:f,niobeClient:h,pushNotificationsKey:n.default.get('pushNotificationsKey'),serviceWorkerRegistration:t}};var o=r(d[1]),n=t(r(d[2])),s=r(d[3]),c=r(d[4]),u=t(r(d[5])),l=r(d[6]),f=r(d[7]),p=r(d[8]);let v,h,_;const w=new Promise(t=>{_=t})},"436356",["ba7a76","3e4681","ef2bc3","f2f40f","a2c93f","06a99e","159ba6","0a0e02","627c69"]);
__d(function(g,_r,_i,_a,_m,_e,d){"use strict";Object.defineProperty(_e,"__esModule",{value:!0}),_e.Workbox=void 0;try{self["workbox:window:6.1.1"]&&_()}catch(n){}function n(n,e){return new Promise(function(t){var r=new MessageChannel;r.port1.onmessage=function(n){t(n.data)},n.postMessage(e,[r.port2])})}function e(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function t(n,e){(null==e||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function r(n,e){var r;if("undefined"==typeof Symbol||null==n[Symbol.iterator]){if(Array.isArray(n)||(r=(function(n,e){if(n){if("string"==typeof n)return t(n,e);var r=Object.prototype.toString.call(n).slice(8,-1);return"Object"===r&&n.constructor&&(r=n.constructor.name),"Map"===r||"Set"===r?Array.from(n):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?t(n,e):void 0}})(n))||e&&n&&"number"==typeof n.length){r&&(n=r);var o=0;return function(){return o>=n.length?{done:!0}:{done:!1,value:n[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(r=n[Symbol.iterator]()).next.bind(r)}try{self["workbox:core:6.1.1"]&&_()}catch(n){}var o=function(){var n=this;this.promise=new Promise(function(e,t){n.resolve=e,n.reject=t})};function i(n,e){var t=location.href;return new URL(n,t).href===new URL(e,t).href}var a=function(n,e){this.type=n,Object.assign(this,e)};function s(n,e,t){return t?e?e(n):n:(n&&n.then||(n=Promise.resolve(n)),e?n.then(e):n)}function c(){}var u={type:"SKIP_WAITING"};function f(n,e){if(!e)return n&&n.then?n.then(c):Promise.resolve()}_e.Workbox=(function(t){var r,c;function v(n,e){var r,c;return void 0===e&&(e={}),(r=t.call(this)||this).nn={},r.tn=0,r.rn=new o,r.en=new o,r.on=new o,r.un=0,r.an=new Set,r.cn=function(){var n=r.fn,e=n.installing;r.tn>0||!i(e.scriptURL,r.sn)||performance.now()>r.un+6e4?(r.vn=e,n.removeEventListener("updatefound",r.cn)):(r.hn=e,r.an.add(e),r.rn.resolve(e)),++r.tn,e.addEventListener("statechange",r.ln)},r.ln=function(n){var e=r.fn,t=n.target,o=t.state,i=t===r.vn,s={sw:t,isExternal:i,originalEvent:n};!i&&r.mn&&(s.isUpdate=!0),r.dispatchEvent(new a(o,s)),"installed"===o?r.wn=self.setTimeout(function(){"installed"===o&&e.waiting===t&&r.dispatchEvent(new a("waiting",s))},200):"activating"===o&&(clearTimeout(r.wn),i||r.en.resolve(t))},r.dn=function(n){var e=r.hn;e===navigator.serviceWorker.controller&&(r.dispatchEvent(new a("controlling",{sw:e,originalEvent:n,isUpdate:r.mn})),r.on.resolve(e))},r.gn=(c=function(n){var e=n.data,t=n.source;return s(r.getSW(),function(){r.an.has(t)&&r.dispatchEvent(new a("message",{data:e,sw:t,originalEvent:n}))})},function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];try{return Promise.resolve(c.apply(this,n))}catch(n){return Promise.reject(n)}}),r.sn=n,r.nn=e,navigator.serviceWorker.addEventListener("message",r.gn),r}c=t,(r=v).prototype=Object.create(c.prototype),r.prototype.constructor=r,r.__proto__=c;var h,l,p=v.prototype;return p.register=function(n){var e=(void 0===n?{}:n).immediate,t=void 0!==e&&e;try{var r=this;return(function(n,e){var t=n();return t&&t.then?t.then(e):e()})(function(){if(!t&&"complete"!==document.readyState)return f(new Promise(function(n){return window.addEventListener("load",n)}))},function(){return r.mn=Boolean(navigator.serviceWorker.controller),r.yn=r.pn(),s(r.bn(),function(n){r.fn=n,r.yn&&(r.hn=r.yn,r.en.resolve(r.yn),r.on.resolve(r.yn),r.yn.addEventListener("statechange",r.ln,{once:!0}));var e=r.fn.waiting;return e&&i(e.scriptURL,r.sn)&&(r.hn=e,Promise.resolve().then(function(){r.dispatchEvent(new a("waiting",{sw:e,wasWaitingBeforeRegister:!0}))}).then(function(){})),r.hn&&(r.rn.resolve(r.hn),r.an.add(r.hn)),r.fn.addEventListener("updatefound",r.cn),navigator.serviceWorker.addEventListener("controllerchange",r.dn,{once:!0}),r.fn})})}catch(n){return Promise.reject(n)}},p.update=function(){try{return this.fn?f(this.fn.update()):void 0}catch(n){return Promise.reject(n)}},p.getSW=function(){return void 0!==this.hn?Promise.resolve(this.hn):this.rn.promise},p.messageSW=function(e){try{return s(this.getSW(),function(t){return n(t,e)})}catch(n){return Promise.reject(n)}},p.messageSkipWaiting=function(){this.fn&&this.fn.waiting&&n(this.fn.waiting,u)},p.pn=function(){var n=navigator.serviceWorker.controller;return n&&i(n.scriptURL,this.sn)?n:void 0},p.bn=function(){try{var n=this;return(function(n,e){try{var t=n()}catch(n){return e(n)}return t&&t.then?t.then(void 0,e):t})(function(){return s(navigator.serviceWorker.register(n.sn,n.nn),function(e){return n.un=performance.now(),e})},function(n){throw n})}catch(n){return Promise.reject(n)}},h=v,(l=[{key:"active",get:function(){return this.en.promise}},{key:"controlling",get:function(){return this.on.promise}}])&&e(h.prototype,l),v})((function(){function n(){this.Pn=new Map}var e=n.prototype;return e.addEventListener=function(n,e){this.Sn(n).add(e)},e.removeEventListener=function(n,e){this.Sn(n).delete(e)},e.dispatchEvent=function(n){n.target=this;for(var e,t=r(this.Sn(n.type));!(e=t()).done;)(0,e.value)(n)},e.Sn=function(n){return this.Pn.has(n)||this.Pn.set(n,new Set),this.Pn.get(n)},n})())},"47df49",[]);
__d(function(g,r,i,a,m,e,d){'use strict';Object.defineProperty(e,"__esModule",{value:!0});var o=e.RookeryMessagePackageEvent={defaultProps:{schema:'com.airbnb.jitney.event.logging.Rookery:RookeryMessagePackageEvent:1.0.0',event_name:'rookery_message_package'},propTypes:{}};o.fullyQualifiedName='Rookery.v1.RookeryMessagePackageEvent';e.RookeryMessagePackageEventEvent=function(t){return{eventData:t,eventDataSchema:o}}},"5db83d",[]);
__d(function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var t={log:!0,markMilestone:!0};e.markMilestone=e.log=void 0;var o=r(d[0]),n=r(d[1]),c=r(d[2]);Object.keys(c).forEach(function(o){"default"!==o&&"__esModule"!==o&&(Object.prototype.hasOwnProperty.call(t,o)||o in e&&e[o]===c[o]||Object.defineProperty(e,o,{enumerable:!0,get:function(){return c[o]}}))});var l=r(d[3]);Object.keys(l).forEach(function(o){"default"!==o&&"__esModule"!==o&&(Object.prototype.hasOwnProperty.call(t,o)||o in e&&e[o]===l[o]||Object.defineProperty(e,o,{enumerable:!0,get:function(){return l[o]}}))});var u=r(d[4]);Object.keys(u).forEach(function(o){"default"!==o&&"__esModule"!==o&&(Object.prototype.hasOwnProperty.call(t,o)||o in e&&e[o]===u[o]||Object.defineProperty(e,o,{enumerable:!0,get:function(){return u[o]}}))});var f=r(d[5]);Object.keys(f).forEach(function(o){"default"!==o&&"__esModule"!==o&&(Object.prototype.hasOwnProperty.call(t,o)||o in e&&e[o]===f[o]||Object.defineProperty(e,o,{enumerable:!0,get:function(){return f[o]}}))});const s='Service Worker:Push Initializer';e.log=(0,o.createLogger)(s,(0,o.createPrefixStyle)('rebeccapurple','#fff')),e.markMilestone=(0,n.createMarkMilestone)(s,'web_push')},"627c69",["102445","fae72a","e6eac9","3d5c9c","907b9b","9179c5"]);
__d(function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;function n(){const t=r(d[1]);return n=function(){return t},t}Object.defineProperty(e,"__esModule",{value:!0}),e.addUpdateCurrencyCallback=function(t){l=t},e.default=function(t,s){(0,c.changeCurrency)(t).then(()=>{if((0,o.setCookieSync)('currency',t,{path:'/'}),u.default.setCurrent({...u.default.current(),curr:t}),l(),s){const[c,o]=s.split('#'),[u,l]=c.split('?'),f=(0,n().parse)(l);delete f.search_type,delete f.search_mode,delete f.suggested_filters_applied;const p=(0,n().stringify)({...f,display_currency:t},{arrayFormat:'brackets'});return void window.location.assign(`${u}?${p}${o?`#${o}`:''}`)}const{pathname:f}=window.location;window.location.replace(`${f}${(0,c.replaceCurrencyParam)(t)}`)})};var c=r(d[2]),o=r(d[3]),u=t(r(d[4]));let l=()=>{}},"737fda",["ba7a76","e950a3","d46747","13babd","06a99e"]);
__d(function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default={name:'UpdateUserCurrency',type:'mutation',operationId:'b81c638d89d602e5df10cecfc8778f345fa605550c93140a6dbb067f24632f20'}},"81c2e1",[]);
__d(function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.optIntoPushNotifications=async function(){const u=await(0,s.getInitializeOptions)();if(!await(0,o.requestPermission)())return(0,p.markMilestone)({options:u,metric:'permission_denied'}),!1;(0,p.markMilestone)({options:u,metric:'permission_granted'});if(await(0,n.hasValidDeviceId)())return(0,p.markMilestone)({description:"Using validated cached device id.",options:u,metric:'device_id_cached'}),await(0,c.verifyOrCreateSubscription)(),!0;(0,p.markMilestone)({description:"Creating a new device id and push subscription.",options:u,metric:'no_device_id_cached'});try{await(0,t.clearSubscription)()}finally{await(0,c.verifyOrCreateSubscription)()}return!0};var t=r(d[0]),n=r(d[1]),s=r(d[2]),o=r(d[3]),c=r(d[4]),p=r(d[5])},"907b9b",["e6eac9","e62feb","436356","0a0e02","ea19bb","627c69"]);
__d(function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.updateSubscriptionIfOptedIn=async function(){if(!await(0,n.hasValidDeviceId)())return(0,s.log)(()=>'user has not opted in, attempt to find and clear invalid push subscription'),(0,t.clearSubscription)();return(0,u.verifyOrCreateSubscription)()};var t=r(d[0]),n=r(d[1]),u=r(d[2]),s=r(d[3])},"9179c5",["e6eac9","e62feb","ea19bb","627c69"]);
__d(function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=async function(t){const{niobeClient:o}=await(0,s.getInitializeOptions)(),{error:l,data:p}=await o.mutate({unsafe__shouldThrowErrors:!0,mutation:u.default,variables:{request:t}});if(l?.graphQLErrors&&l.graphQLErrors.length>0){const o='Failed to send push token due to network error';f(()=>[o,l.graphQLErrors]);const s={extra:{...l.graphQLErrors[0],...t},fingerprint:['PushTokenUpdateFailure']},u=new Error(l.graphQLErrors[0]?.message??o);throw(0,n.reportError)(u,s),u}return f(()=>['Sent push token to upstream server',p]),p?.pleiades?.writeToken?.deviceId};var o=r(d[1]),n=r(d[2]),s=r(d[3]),u=t(r(d[4]));const f=(0,o.createLogger)('Push:Send Token',(0,o.createPrefixStyle)('#b95f6f','#fff'))},"96c3e8",["ba7a76","102445","f2f40f","436356","dbdcfd"]);
__d(function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=async function(t){const{default:u}=await n.scheduler.postTask(s);return u(t)};var u=t(r(d[1])),n=r(d[2]);const s=()=>r(d[4])(d[3]).then(u.default)},"a2fd9f",["ba7a76","45f788","a2c93f","436356","057569"]);
__d(function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;function n(){const t=r(d[1]);return n=function(){return t},t}Object.defineProperty(e,"__esModule",{value:!0}),e.changeCurrency=async function(t,n,s){const{idStr:y}=o.default.current(),_=s||y;if(!_)return Promise.resolve();const f=(0,c.createGlobalId)('User',_);return(n||(0,u().getBrowserNiobeStandaloneClient)()).mutate({unsafe__shouldThrowErrors:!0,mutation:l.default,variables:{input:{id:f,userData:{nativeCurrency:t}}}})},e.replaceCurrencyParam=function(t,c={}){const u={...(0,n().parse)(window.location.search.slice(1)),display_currency:t,...c};delete u.display_currency,u.currency=t,u.guestCurrency&&(u.guestCurrency=t);u.currency&&(u.currency=t);u.guest_currency&&(u.guest_currency=t);u.price_min&&delete u.price_min;u.price_max&&delete u.price_max;delete u.search_type,delete u.search_mode,delete u.suggested_filters_applied;const o=`?${(0,n().stringify)(u,{arrayFormat:'brackets'})}${window.location.hash}`;return(0,s.getHistory)().replace(o),o};var c=r(d[2]);function u(){const t=r(d[3]);return u=function(){return t},t}var s=r(d[4]),o=t(r(d[5])),l=t(r(d[6]))},"d46747",["ba7a76","e950a3","56afe0","ba6295","7934b6","06a99e","81c2e1"]);
__d(function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){const{userAgent:t}=navigator;if((0,n.isAndroid)(t))return'ANDROID_VAPID';if((0,n.isIphone)(t))return'IPHONE_VAPID';if((0,n.isIpad)(t))return'IPAD_VAPID';return'DESKTOP_VAPID'};var n=r(d[0])},"d93056",["e9b7bf"]);
__d(function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default={name:'SendPushTokenMutation',type:'mutation',operationId:'35f85d8e0ca316c774486242fa697b3b3dd26597467c7744cd45fc6d25282d1c'}},"dbdcfd",[]);
__d(function(g,r,i,a,m,e,d){"use strict";function t(){const n=r(d[0]);return t=function(){return n},n}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;const n={RookeryMessagePackageEvent:t().RookeryMessagePackageEvent};e.default=n},"e1839b",["5db83d"]);
__d(function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;function n(){const t=r(d[1]);return n=function(){return t},t}Object.defineProperty(e,"__esModule",{value:!0}),e.default=async function(t){const c=t||l();if(!c){const t='Cannot create device id with no user id';throw s(()=>t),new Error(t)}const o=await _(),I=o?.deviceId;if(I&&p(c,o))return s(()=>`Using "${I}" as stored device push id`),I;const w=(0,n().v4)();return(0,u.storeInCache)(v,f,h({deviceId:w,userId:c})),w},e.hasValidDeviceId=async function(){const t=l();if(!t)return!1;const n=await _();return p(t,n)};var c=r(d[2]),u=r(d[3]),o=t(r(d[4]));const s=(0,c.createLogger)('Push:Device Id',(0,c.createPrefixStyle)('#b95f6f','#fff')),f='push_token_id',v='airbnb_push_notifications',I=':';function h({deviceId:t,userId:n}){return`${n}${I}${t}`}function l(){return o.default.current().idStr}function _(){return(0,u.getFromCache)(v,f).then(t=>{if(!t)return;const[n,c]=t.split(I);return{userId:n,deviceId:c}})}function p(t,n){return!(!n?.deviceId||n?.userId!==t)}},"e62feb",["ba7a76","305dd5","102445","fe8083","06a99e"]);
__d(function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.clearSubscription=async function(){const o=await(0,n.getInitializeOptions)(),{serviceWorkerRegistration:u}=o,c=await u.pushManager.getSubscription();if(!c)return!0;try{await c.unsubscribe()}catch(n){(0,t.reportError)(n,{originalError:n}),(0,s.markMilestone)({options:o,metric:'unsubscribe_failure'})}return(0,s.log)(()=>'Push subscription has been unsubscribed.'),!0};var t=r(d[0]),n=r(d[1]),s=r(d[2])},"e6eac9",["f2f40f","436356","627c69"]);
__d(function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.verifyOrCreateSubscription=async function(){if(!await(0,u.hasPermission)())return;const t=await(0,o.getInitializeOptions)(),{pushNotificationsKey:f,serviceWorkerRegistration:w}=t;try{let s=await w.pushManager.getSubscription();s||(s=await w.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:f}));const n=await(0,c.default)(s),o=await(0,l.default)(n);return(0,p.markMilestone)({description:`Push notifications successfully initialized with key: "${f}".`,options:t,metric:'push_subscribe_success',metricPrefix:'service_worker'}),o}catch(o){(0,p.markMilestone)({options:t,metric:'push_subscribe_unknown_failure',metricPrefix:'service_worker'}),(0,s.reportError)(o,{fingerprint:o?.message?['PushUnknownFailure']:void 0,originalError:o}),await(0,n.clearSubscription)()}};var s=r(d[1]),n=r(d[2]),o=r(d[3]),c=t(r(d[4])),u=r(d[5]),l=t(r(d[6])),p=r(d[7])},"ea19bb",["ba7a76","f2f40f","e6eac9","436356","35b332","0a0e02","96c3e8","627c69"]);
__d(function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.createMarkMilestone=function(n,c="service_worker"){const s=(0,o.createLogger)(n,(0,o.createPrefixStyle)('rebeccapurple','#fff'));return function({count:o=1,options:n,metric:u,metricPrefix:f,description:l,tags:p}){const{datadogTags:_}=n,$=[_,p].filter(Boolean).join(','),j=f??c;(0,t.airdogCount)(`${j}.milestone`,o,[`metric:${u}`,$].join(',')),(0,t.airdogCount)(`${j}.${u}`,o,$),l&&s(()=>[l,{datadogTags:$,metric:u}])}};var t=r(d[0]),o=r(d[1])},"fae72a",["3e4681","102445"]);
__d(function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,e.getServiceWorkerPath=W,e.uninstallServiceWorker=P;var n=r(d[1]),o=r(d[2]),s=r(d[3]),c=r(d[4]),l=r(d[5]),p=r(d[6]),_=t(r(d[7])),f=r(d[8]),v=r(d[9]),h=r(d[10]),u=t(r(d[11])),w=r(d[12]),y=r(d[13]),k=t(r(d[14])),b=t(r(d[15])),S=t(r(d[16])),E=r(d[17]);const T=(0,s.createLogger)('ServiceWorker:Installer',(0,s.createPrefixStyle)('rebeccapurple','#fff')),A=(0,h.createMarkMilestone)('ServiceWorker:Installer');function C(t,n,o){const s=new URLSearchParams;Object.keys(n).forEach(t=>{const o=n[t];null!=o&&!1!==o&&s.append(t,String(o))}),o&&Object.keys(o).forEach(t=>{const n=o[t];null!=n&&s.append(t,String(n))});const c=String(s);return c.length?`${t}?${c}`:t}function W(t,n={appType:'GLOBAL_TRAVEL',pushNotifications:!1,deliverAppShellExperiment:!1,deliverPreCachingExperiment:!1,deliverTripsOfflineExperiment:!1,dynamicPrecaching:!1,datadogTags:''}){const{deliverAppShellExperiment:o,deliverPWAExperiment:s,deliverPreCachingExperiment:c,deliverTripsOfflineExperiment:l,disableAppShell:p,dynamicPrecaching:_}=n,{force_disable_3p_js:f,force_env:v,force_staging:h,offline:y,sw_workbox_dev_logs:k,utm_source:S,enableReactProfiler:E}=(0,u.default)();return C(t,{dynamic_precaching:_,deliver_app_shell_experiment:o,deliver_pre_caching_experiment:c,deliver_trips_offline_experiment:l,disable_app_shell:p,force_disable_3p_js:f,force_env:v,force_staging:h,enableReactProfiler:E,offline:y,sw_workbox_dev_logs:k,sw_disable_niobe_cache:(0,w.getTreatmentOverride)('sw_disable_niobe_cache')??b.default.getBootstrap('sw_disable_niobe_cache'),sw_pwa_disable_niobe_cache:(0,w.getTreatmentOverride)('sw_pwa_disable_niobe_cache')??b.default.getBootstrap('sw_pwa_disable_niobe_cache'),sw_allow_shell_on_search_verticals:(0,w.getTreatmentOverride)('sw_allow_shell_on_search_verticals')??b.default.getBootstrap('sw_allow_shell_on_search_verticals'),utm_source:S},{sw_enable_offline:s})}function O(t,n){const{pushNotifications:o}=n;(0,y.addLoginCompleteCallback)(async()=>{await t.messageSW({type:'CLEAR_CACHES'}),A({metric:'login_and_clear_cache',description:'Any caches storing an app shell have been cleared after login.',options:n}),o&&(0,p.updateSubscriptionIfOptedIn)()}),(0,y.addLogoutCallback)(async()=>{await t.messageSW({type:'CLEAR_CACHES'}),A({metric:'logout_and_clear_cache',description:'Any caches storing an app shell have been cleared after logout.',options:n}),(0,p.clearSubscription)()})}const L='skipping start of the service worker due to user opted out, remove your user from "temporarily_disable_service_workers_for_me" to opt back in.',R='service workers are globally disabled, skipping start';async function I(t,o={appType:'GLOBAL_TRAVEL',pushNotifications:!1,deliverTripsOfflineExperiment:!1,deliverAppShellExperiment:!1,deliverPreCachingExperiment:!1,dynamicPrecaching:!1,datadogTags:''}){const{appType:s,datadogTags:v,niobeClient:h,pushNotifications:u}=o,w=W(t,o),y=new n.Workbox(w,{updateViaCache:'all'}),b=`Initializing service worker at path: "${t}", see https://air.bb/service-workers for debugging guides.`;T(()=>[b,{pathWithParams:w}]),O(y,o),(0,l.addUpdateCurrencyCallback)(async()=>{await y.messageSW({type:'CLEAR_CACHES'}),A({metric:'update_currency_and_clear_cache',description:'Any caches storing an app shell have been cleared after updating currency.',options:o}),u&&(0,p.updateSubscriptionIfOptedIn)()}),y.addEventListener('installed',async t=>{A({options:o,metric:'installation',description:'Install event is fired'}),t.isUpdate?A({metric:'version_updated',description:'An installed service worker was updated to a new version.',options:o}):A({metric:'first_installation',description:'A new service worker has installed (for the first time)',options:o}),(o.dynamicPrecaching||o.deliverTripsOfflineExperiment)&&await y.messageSW({type:'PRECACHE_ASSETS',payload:{appVersion:"Unknown"}})}),y.addEventListener('controlling',async()=>{await y.messageSW({type:'FLUSH_MESSAGES'}),A({options:o,metric:'controlling',description:'The service worker is controlling the page, all behavior such as app shells, fetch handlers and push handlers are now ready.'})}),y.addEventListener('message',t=>{switch(t.data.type){case'AIRDOG_BUMP':if('string'==typeof t.data.event)A({options:o,metric:`message.${t.data.event}`});else{const{name:n,count:s,tags:c}=t.data.event;A({count:s,options:o,metric:`message.${n}`,tags:c})}break;case'LOG_JITNEY_EVENT':k.default.logJitneyEvent({event_data:t.data.eventData,schema:S.default[t.data.schemaName]});break;case'SW_ERROR':A({description:'An error occurred in the service worker.',options:o,metric:'worker_error'}),(0,c.reportError)(t.data.error,{tags:{service_worker_error_type:'service_worker.worker_error'}});break;case'NOTIFICATION_CLICKED':A({description:'A push notification was clicked.',options:o,metric:'push_notification_clicked'}),(0,f.dispatchNotification)(t.data.payload)}}),y.addEventListener('activated',async t=>{if(!t.isUpdate&&u){const t=await navigator.serviceWorker.getRegistration();t&&h&&(T(()=>'Initializing push notifications.'),await(0,_.default)({serviceWorkerRegistration:t,datadogTags:v,appType:s,niobeClient:h}))}A({description:'The service worker has finished activating.',options:o,metric:'activated_new_version'})}),y.addEventListener('waiting',async()=>{if(await y.messageSW({type:'SKIP_WAITING'}))T(()=>'Manual reload signal in development received, reloading page'),location.reload(!0);else{const t='Automatic service worker activation failed, you may need to hard refresh the page to get the new worker.';T(()=>t)}A({options:o,metric:'waiting_to_install'})});try{const t=await y.register();t&&u&&t.active&&h&&(T(()=>'Initializing push notifications.'),(0,_.default)({serviceWorkerRegistration:t,appType:s,datadogTags:v,niobeClient:h})),A({options:o,metric:'registration'})}catch(t){'SecurityError'!==t?.name?A({description:'The service worker failed to install.',options:o,metric:'failed_installation'}):T(()=>['The service worker failed to install due to a SecurityError',t])}}async function P(t){try{if((await navigator.serviceWorker.getRegistrations()).filter(({scope:t})=>t.endsWith('/')).length){T(()=>'No service worker was registered but one is active, removing and if in development, reloading the page.');try{(0,E.unregisterServiceWorker)({legacyOnly:!1})}finally{}}}catch(n){'SecurityError'!==n?.name&&A({description:'The service worker failed to uninstall.',options:t,metric:'failed_uninstallation'})}}function x(t){return b.default.getBootstrap('disable_all_service_workers')||t}e.default=async(t,n={})=>{if('undefined'==typeof navigator||!navigator.serviceWorker)return;const s=`registered_path:${t}`,c=(0,v.makeDatadogTags)(s),l={...n,datadogTags:[c,n.datadogTags].filter(Boolean).join(',')};if(!t)return void await P(l);A({options:l,metric:'initialization_attempt'});const{forceResetServiceWorker:p}=(0,u.default)();if(p)return await(0,E.unregisterServiceWorker)({legacyOnly:!1}),void(window.location.search=window.location.search.replace('forceResetServiceWorker','swResetComplete'));const _=b.default.getBootstrap('temporarily_disable_service_workers_for_me'),f=x(_),h=await W(t,l);try{await(0,E.unregisterServiceWorker)({legacyOnly:!f,serviceWorkerPath:h,datadogTags:c})}catch(n){f?T(()=>_?L:R):(await I(t,l),(0,o.airdogCount)('service_worker.initialization_failed',1,c))}f?T(()=>_?L:R):await I(t,l)}},"feb86f",["ba7a76","47df49","3e4681","102445","f2f40f","737fda","627c69","a2fd9f","2d8379","159ba6","fae72a","a7c4ef","f9341a","9f7af8","c8b97a","c235f8","e1839b","178ec4"]);
//# sourceMappingURL=https://sourcemaps.d.musta.ch/airbnb/static/packages/web/common/frontend/service-workers/initialize.122de1a5e0.js.map