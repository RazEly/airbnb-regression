__d(function(g,r,i,a,m,e,d){"use strict";var n=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(n,c){const f=(0,s.default)(),p=(0,o.useNaviInternalContext)();return(0,t.useEffect)(()=>(f(()=>`Creating scope "${n}"`),p.addScope(n,c),()=>{f(()=>`Unmounting scope "${n}" and cleaning up`),p.removeScope(n)}),[n]),(0,t.useEffect)(()=>{p.updateScopeDependencies(n,c)},[n,c]),u(n)},e.useExistingScope=void 0;var t=r(d[1]),o=r(d[2]),s=n(r(d[3]));function u(n){const s=(0,o.useNaviInternalContext)();return(0,t.useMemo)(()=>({registerPresenter:t=>s.registerPresenter(t,n),removePresenter:t=>s.removePresenter(t,n),scheduleAnnouncement:t=>s.scheduleAnnouncement(t,n),scheduleAnnouncements:t=>s.scheduleAnnouncements(t,n),removeAnnouncement:(t,o)=>s.removeAnnouncement(t,n,o),findAnnouncement:(n,t)=>s.findAnnouncement(n,t),startPresentation:()=>s.startPresentation(n),reset:()=>s.resetScope(n),remove:()=>s.removeScope(n)}),[n])}e.useExistingScope=u},"014366",["ba7a76","07aa1f","7b3437","c809cd"]);
__d(function(g,r,i,a,m,e,d){"use strict";var n=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.getAnnouncementKey=e.getAnnouncement=e.default=e.coerceToFutureAnnouncement=e.FutureAnnouncementSingleDevice=void 0;var t=n(r(d[1])),c=n(r(d[2]));class u extends c.default{constructor(...n){super(...n),this.announcement=void 0,this.timer=void 0}ready(n){n&&(this.announcement.content=n),super.resolve(this.announcement),this.clearTimeout()}cancel(){super.reject(),this.clearTimeout()}startTimeout(){}clearTimeout(){this.timer&&clearTimeout(this.timer)}}class o extends u{constructor(n){super(),this.announcement=new t.default.SingleDevice(n)}}e.FutureAnnouncementSingleDevice=o;class s extends u{constructor(n){super(),this.announcement=new t.default(n)}}e.default=s,s.SingleDevice=o;e.coerceToFutureAnnouncement=n=>{if(n instanceof s||n instanceof o)return n;const c=n instanceof t.default?new s(n):new s.SingleDevice(n);return c.ready(),c};const l=n=>n instanceof s||n instanceof o?n.announcement:n;e.getAnnouncement=l;e.getAnnouncementKey=n=>l(n).key},"068775",["ba7a76","f4362a","0af475"]);
__d(function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(){this.promise=void 0,this.isFulfilled=!1,this.promiseResolve=void 0,this.promiseReject=void 0,this.isFulfilled=!1,this.promise=new Promise((s,t)=>{this.promiseResolve=s,this.promiseReject=t})}resolve(s){return this.isFulfilled||(this.isFulfilled=!0,this.promiseResolve(s)),this}reject(s){return this.catch(()=>{}),this.promiseReject(s),this}then(...s){return this.promise.then(...s)}catch(s){return this.promise.catch(s)}}},"0af475",[]);
__d(function(g,r,i,a,m,e,d){"use strict";var n=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.isCanvasAnnouncementEnabled=e.default=e.CANVAS_PREVIEW_ANNOUNCEMENT_ID=void 0;var t=r(d[1]),u=n(r(d[2])),N=n(r(d[3]));const _=e.CANVAS_PREVIEW_ANNOUNCEMENT_ID='CANVAS_PREVIEW_ANNOUNCEMENT_ID';e.isCanvasAnnouncementEnabled=()=>t.Flagger.isTrebuchetLaunched((0,u.default)('canvas.announcements'));const E=new N.default((n,t)=>n===_||'MCPAnnouncementMicroMegaContent'===t?.__typename);e.default=E},"0dd5ca",["ba7a76","dcc72a","2c6bf9","cee790"]);
__d(function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isEqualSet=void 0;e.isEqualSet=(s,t)=>s.size===t.size&&[...s].every(s=>t.has(s))},"1a5f67",[]);
__d(function(g,r,i,a,m,e,d){"use strict";var _=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.HOST_TOS_ANNOUNCEMENT_ID=void 0;var N=_(r(d[1]));const t=e.HOST_TOS_ANNOUNCEMENT_ID='HOST_TOS_ANNOUNCEMENT_ID',O=new N.default(t);e.default=O},"20f028",["ba7a76","cee790"]);
__d(function(g,r,i,a,m,e,d){"use strict";var n=r(d[0]).default,t=r(d[1]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){const n=(0,v.default)(),t=(0,u().useNiobeClient)(),[S]=(0,u().useMutation)(w.default,{unsafe__shouldThrowErrors:!0}),_=(0,o.useRef)(new Map),E=(0,o.useRef)(new Map),T=n=>n.expirationUtcDateTime&&new Date(n.expirationUtcDateTime)<new Date,k=(0,o.useCallback)(t=>{const o=I(t),c=E.current.get(o);if(c&&!T(c))return c;const s=(0,l.localStorageGetItem)(P()),u=s?.[o];return n(()=>s&&u?[`Local storage cache found for ${o}`,u]:[`No local storage cache found for ${o}`]),u&&!T(u)?u:null},[]),$=(0,o.useCallback)((t,o)=>{const c=I(t);E.current.set(c,o);const s=P(),u=(0,l.localStorageGetItem)(s)||{};u[c]=o,n(()=>[`Update local storage cache for ${c}`,u[c]]),(0,l.localStorageSetItem)(s,u,{expires:A})},[]),H=(0,o.useCallback)((n,t)=>{const o=k(n);$(n,{impressionCount:(o?.impressionCount||0)+1,createdAtUtcDateTime:(new Date).toISOString(),expirationUtcDateTime:t})},[]),N=(0,o.useCallback)(async n=>{const o=await t.query({unsafe__shouldThrowErrors:!0,query:h.default,variables:{impressionId:n.id,discriminator:n.discriminator}}),c=o?.data?.viewer?.naviAnnouncementImpressionInfo;if(!c)throw _.current.delete(I(n)),new Error('No impression data returned from server');return c},[]),L=(0,o.useCallback)(n=>{const t=I(n),o=_.current.get(t);if(o)return o;const c=N(n);return _.current.set(t,c),c},[]),W=n=>{const t=R(n.id,n.discriminator);return t||(n.impressionPolicy?.forceDiscard?C.AnnouncementShowState.DROP:n.impressionPolicy?.forceShow?C.AnnouncementShowState.SHOW:void 0)},M=(0,o.useCallback)(async t=>{const o=W(t);return o||(U(t)?C.AnnouncementShowState.SHOW:x.handles(t)?x.shouldShow(t,k,L,$,n):b.shouldShow(t,k,L,$,n))},[]),V=(0,o.useCallback)(t=>{const o=(0,D.getAnnouncement)(t);W(o)||U(o)||o instanceof y.SingleDeviceAnnouncement||f.default.isLoggedIn()&&(n(()=>`Starting impression request for ${o.key}`),x.handles(o)?x.optimisticFetch(o,k,L):b.optimisticFetch(o,k,L))},[]),F=async(n,t)=>{const{data:o}=await S({variables:{impressionId:n.id,discriminator:n.discriminator,uuid:(0,c().v4)(),impressionExpirationUtcDateTime:t}});'NaviAnnouncementImpressionInfo'===o?.recordNaviAnnouncementView?.__typename&&$(n,o.recordNaviAnnouncementView)},q=(0,o.useCallback)(async t=>{n(()=>`Recording impression for ${t.key}`),p.default.logJitneyEvent({schema:s().UniversalComponentImpressionEvent,event_data:{uuid:(0,c().v4)(),logging_id:(0,O.jitneyId)(t),component:'NaviAnnouncement',ancestor_uuids:[],ancestor_logging_ids:[]}}),U(t)||(x.handles(t)?x.optimisticCacheUpdate(t,H):b.optimisticCacheUpdate(t,H),t instanceof y.SingleDeviceAnnouncement||f.default.isLoggedIn()&&(x.handles(t)?x.recordImpression(t,F):b.recordImpression(t,F)))},[]),G=(0,o.useCallback)(()=>{_.current.clear()},[]);return(0,o.useMemo)(()=>({startImpressionRequest:V,shouldShowAnnouncement:M,recordImpression:q,clearRequestCache:G}),[])};var o=r(d[2]);function c(){const n=r(d[3]);return c=function(){return n},n}function s(){const n=r(d[4]);return s=function(){return n},n}function u(){const n=r(d[5]);return u=function(){return n},n}var l=r(d[6]),p=t(r(d[7])),f=t(r(d[8])),S=r(d[9]),h=t(r(d[10])),w=t(r(d[11])),C=r(d[12]),D=r(d[13]),y=n(r(d[14])),O=r(d[15]),v=t(r(d[16]));const A=31536e6;function P(){return`navi_announcements_impressions_${f.default.current().idStr||'logged_out'}`}const I=({id:n,discriminator:t})=>t?`${n}_${t}`:n,U=({impressionPolicy:n})=>!('maxCap'in n);function _(n){switch(n.timeUnit){case y.CoolOffUnit.MILLISECONDS:return n.value;case y.CoolOffUnit.SECONDS:return 1e3*n.value;case y.CoolOffUnit.MINUTES:return 1e3*n.value*60;case y.CoolOffUnit.HOURS:return 1e3*n.value*60*60;case y.CoolOffUnit.DAYS:return 1e3*n.value*60*60*24;case y.CoolOffUnit.MONTHS:return 1e3*n.value*60*60*24*30;case y.CoolOffUnit.YEARS:return 1e3*n.value*60*60*24*365;default:return n.value}}const R=(n,t)=>{{const o=new URL(document.location.href).searchParams,c=o.get('naviDebugPolicies'),s=o.get('naviOnlyShow');if(o.get('naviHideAll'))return C.AnnouncementShowState.DROP;if(s){return s.split(',').map(n=>n.split('::')).find(([o,c])=>o===n&&c===t)?C.AnnouncementShowState.SHOW:C.AnnouncementShowState.DROP}if(c){const t=c.split(',').map(n=>n.split(':')).find(([t])=>t===n)?.[1];if('SHOW'===t)return C.AnnouncementShowState.SHOW;if('DROP'===t)return C.AnnouncementShowState.DROP}}};function E(n,t,o){return!!t&&(t.impressionCount>=n||o&&t.impressionCount>0&&_(o)>Date.now()-new Date(t.createdAtUtcDateTime).getTime())}const T=n=>U(n)||(0,S.getConsentForTool)('Airbnb Functional')||n.noConsentBehavior===C.NoConsentBehavior.SHOW?C.AnnouncementShowState.SHOW:C.AnnouncementShowState.DROP,k=n=>n.choreographyInfo.priority===C.Priority.POISON_PILL||n.choreographyInfo.priority===C.Priority.LEGAL?C.AnnouncementShowState.SHOW:C.AnnouncementShowState.DROP;class b{static handles(n){return'maxCap'in n.impressionPolicy}static optimisticFetch(n,t,o){const{maxCap:c,localCoolOff:s}=n.impressionPolicy;E(c,t(n),s)||o(n).catch(()=>{})}static async shouldShow(n,t,o,c,s){const{maxCap:u,localCoolOff:l}=n.impressionPolicy,p=t(n);if(E(u,p,l))return s(()=>[`Dropping ${n.key} (cache)`,p]),C.AnnouncementShowState.DROP;if(n instanceof y.SingleDeviceAnnouncement||!f.default.isLoggedIn())return T(n);try{const t=await o(n);if(c(n,t),E(u,t))return s(()=>[`Dropping ${n.key} (server)`,t]),C.AnnouncementShowState.DROP}catch(t){return s(()=>[`Error fetching ${n.key}:`,t]),k(n)}return C.AnnouncementShowState.SHOW}static optimisticCacheUpdate(n,t){let o=null;'impressionExpirationUtcDateTime'in n.impressionPolicy&&(o=n.impressionPolicy.impressionExpirationUtcDateTime),t(n,o)}static recordImpression(n,t){let o=null;'impressionExpirationUtcDateTime'in n.impressionPolicy&&(o=n.impressionPolicy.impressionExpirationUtcDateTime),t(n,o)}}class x{static handles(n){return'impressionCap'in n.impressionPolicy}static totalCapVariant(n){const t={...n,discriminator:n.discriminator?`${n.discriminator}.__total_cap`:'.__total_cap'};return n instanceof y.SingleDeviceAnnouncement?new y.SingleDeviceAnnouncement(t):new y.default(t)}static optimisticFetch(n,t,o){const{maxCap:c,impressionCap:s,localCoolOff:u}=n.impressionPolicy,l=x.totalCapVariant(n);E(c,t(l),u)||o(l).catch(()=>{});E(s,t(n),u)||o(n).catch(()=>{})}static async shouldShow(n,t,o,c,s){const{impressionCap:u,localCoolOff:l}=n.impressionPolicy;if(await b.shouldShow(x.totalCapVariant(n),t,o,c,s)===C.AnnouncementShowState.DROP)return C.AnnouncementShowState.DROP;const p=t(n);if(E(u,p,l))return s(()=>[`Dropping ${n.key} (cache)`,p]),C.AnnouncementShowState.DROP;if(n instanceof y.SingleDeviceAnnouncement||!f.default.isLoggedIn())return T(n);try{const t=await o(n);if(c(n,t),E(u,t,l))return s(()=>[`Dropping ${n.key} (server)`,t]),C.AnnouncementShowState.DROP}catch(t){return s(()=>[`Error fetching ${n.key}:`,t]),k(n)}return C.AnnouncementShowState.SHOW}static optimisticCacheUpdate(n,t){t(x.totalCapVariant(n),null),t(n,n.impressionPolicy.impressionExpirationUtcDateTime)}static recordImpression(n,t){t(x.totalCapVariant(n),null),t(n,n.impressionPolicy.impressionExpirationUtcDateTime)}}},"2b4782",["45f788","ba7a76","07aa1f","305dd5","15a5fe","068abc","13babd","c8b97a","06a99e","8b1591","a6a446","386890","af724a","068775","f4362a","a8aa8f","c809cd"]);
__d(function(g,r,i,a,m,e,d){"use strict";var n=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(n={}){const{loading:v,data:_}=(0,s().useClientSideQuery)(c.default,{...n,variables:{...n.variables,shouldSkipTaskFooter:o.Flagger.isTrebuchetLaunched((0,u.default)('host_task_system.navi_returns_announcement_without_content'))}}),f=(0,t.useMemo)(()=>(_?.presentation?.naviAnnouncements||[]).map(({id:n,...t})=>'CrossDeviceNaviAnnouncementId'===n.__typename?new l.default({...t,id:n.crossDeviceAnnouncementId,discriminator:n.discriminator||void 0}):new l.default.SingleDevice({...t,id:n.localDeviceAnnouncementId})),[_]);return{loading:v,data:_,announcements:f}};var t=r(d[1]),o=r(d[2]),u=n(r(d[3]));function s(){const n=r(d[4]);return s=function(){return n},n}var c=n(r(d[5])),l=n(r(d[6]))},"379789",["ba7a76","07aa1f","dcc72a","2c6bf9","068abc","c6ac87","f4362a"]);
__d(function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default={name:'RecordNaviAnnouncementView',type:'mutation',operationId:'aade9d0a651edc2144a18d8d72447202b083786fbd97021889e097e13834b55e'}},"386890",[]);
__d(function(g,r,i,a,m,e,d){"use strict";var n=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.useCanvasAnnouncementInProductPreview=void 0;var t=r(d[1]),u=n(r(d[2])),s=n(r(d[3])),c=r(d[4]),o=r(d[5]),v=r(d[6]);e.useCanvasAnnouncementInProductPreview=()=>{const n=(0,u.default)(),l=(0,v.createPreviewConfig)(n),A=(0,c.isCanvasAnnouncementEnabled)()&&null!=l,{loading:f,data:C,error:P}=(0,o.useCanvasAnnouncementPreview)({variables:l??{},skip:!A}),E=C?.presentation?.canvasAnnouncement?.announcements?.[0]?.content,_=(0,s.default)(c.CANVAS_PREVIEW_ANNOUNCEMENT_ID);(0,t.useEffect)(()=>{(0,c.isCanvasAnnouncementEnabled)()&&(f||(!P&&A&&E?_.ready(E):_.cancel()))},[f,P,E,_,A])}},"45b5b2",["ba7a76","07aa1f","a7c4ef","c7e43f","0dd5ca","653072","4a39c9"]);
__d(function(g,r,i,a,m,e,d){"use strict";var n=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.useIsCanvasPreviewEnabled=e.createPreviewConfig=void 0;var t=n(r(d[1])),s=r(d[2]);const c=n=>n.canvas_content_id?{contentId:n.canvas_content_id,contentVersionId:n.canvas_content_version_id??null,megaSectionId:n.canvas_mega_section_id,microSectionId:n.canvas_micro_section_id,hydrationMode:'PRODUCTION',page:n.navi_surface_name??'RESERVATIONS_TAB',userIdOverride:n.test_user_id}:null;e.createPreviewConfig=c;e.useIsCanvasPreviewEnabled=()=>{const n=(0,t.default)();return(0,s.isCanvasAnnouncementEnabled)()&&null!=c(n)}},"4a39c9",["ba7a76","a7c4ef","0dd5ca"]);
__d(function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){const c=`LOW_PRIORITY_SCOPE_${[t.id,t.discriminator].join('.')}`,f=(0,s.default)(c),I=(0,o.useMemo)(()=>new n.default(t.id),[t.id]);return(0,o.useEffect)(()=>{'MARKETING_EDUCATIONAL'!==t.choreographyInfo.priority&&'CELEBRATION_RECOGNITION'!==t.choreographyInfo.priority||(f.registerPresenter(I),f.scheduleAnnouncement(t),f.startPresentation())},[f,t.choreographyInfo.priority]),(0,u.usePresenter)(I)};var o=r(d[1]),n=t(r(d[2])),u=r(d[3]),s=t(r(d[4]))},"4da625",["ba7a76","07aa1f","cee790","708bea","014366"]);
__d(function(g,r,i,a,m,e,d){"use strict";var n=r(d[0]).default,t=r(d[1]).default;Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"AppTarget",{enumerable:!0,get:function(){return u.AppTarget}}),Object.defineProperty(e,"CoolOffTime",{enumerable:!0,get:function(){return P.CoolOffTime}}),Object.defineProperty(e,"NaviAnnouncement",{enumerable:!0,get:function(){return P.default}}),Object.defineProperty(e,"NaviAnnouncementPages",{enumerable:!0,get:function(){return u.NaviAnnouncementPages}}),Object.defineProperty(e,"NaviPresenter",{enumerable:!0,get:function(){return p.default}}),Object.defineProperty(e,"PresentationResult",{enumerable:!0,get:function(){return u.PresentationResult}}),Object.defineProperty(e,"Priority",{enumerable:!0,get:function(){return u.Priority}}),Object.defineProperty(e,"SingleDeviceAnnouncement",{enumerable:!0,get:function(){return P.SingleDeviceAnnouncement}}),Object.defineProperty(e,"useExistingScope",{enumerable:!0,get:function(){return b.useExistingScope}}),Object.defineProperty(e,"useFutureAnnouncement",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(e,"useLowPriorityAnnouncement",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(e,"usePage",{enumerable:!0,get:function(){return f.default}}),Object.defineProperty(e,"usePresenter",{enumerable:!0,get:function(){return l.usePresenter}}),Object.defineProperty(e,"useScope",{enumerable:!0,get:function(){return b.default}});var u=r(d[2]),o=(t(r(d[3])),n(r(d[4]))),c=n(r(d[5])),f=n(r(d[6])),l=r(d[7]),b=t(r(d[8])),P=t(r(d[9])),p=n(r(d[10]));n(r(d[11])),r(d[12])},"502fde",["ba7a76","45f788","af724a","068775","c7e43f","4da625","834679","708bea","014366","f4362a","cee790","fd91b8","fc4d8f"]);
__d(function(g,r,_i,_a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return t.filter(o=>!o.presentationResult).filter(n=>n.showState!==o.AnnouncementShowState.DROP).map((o,n)=>[o,n]).sort(n).map(([o])=>o)};var o=r(d[0]);function n([{choreographyInfo:{priority:n,groupInfo:t}},u],[{choreographyInfo:{priority:a,groupInfo:p}},i]){const f=o.PRIORITY_RANK.indexOf(n),c=o.PRIORITY_RANK.indexOf(a);return f!==c?f-c:t&&!p?-1:!t&&p?1:t&&p?t.groupName!==p.groupName?(s=t.groupName,l=p.groupName,s?l?s.localeCompare(l,'en'):-1:1):t.sequenceOrder-p.sequenceOrder:u-i;var s,l}},"53350f",["af724a"]);
__d(function(g,r,i,a,m,e,d){"use strict";var n=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.createPreviewAnnouncement=void 0;var o=n(r(d[1])),t=r(d[2]),c=n(r(d[3])),l=r(d[4]),u=r(d[5]);e.createPreviewAnnouncement=()=>{const{navi_surface_name:n}=(0,o.default)();return new c.default.SingleDevice({filterInfo:{pages:n?[n]:null},id:u.CANVAS_PREVIEW_ANNOUNCEMENT_ID,campaignEndUtcDateTime:null,impressionPolicy:new l.AlwaysShowPolicy,choreographyInfo:{priority:t.Priority.POISON_PILL},noConsentBehavior:t.NoConsentBehavior.SHOW})}},"5b215d",["ba7a76","a7c4ef","af724a","068775","fc4d8f","0dd5ca"]);
__d(function(g,r,i,a,m,e,d){"use strict";var n=r(d[0]).default,t=r(d[1]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){const n=(0,p.default)(c.GLOBAL_SCOPE_ID),{loading:t,announcements:S}=(0,E.default)({variables:{appTarget:c.AppTarget.HOST},skip:!o.Flagger.isTrebuchetLaunched((0,u.default)('web.navi_server_announcements.host'))}),I=(0,w.useIsCanvasPreviewEnabled)();return(0,s.useEffect)(()=>{!t&&S.length&&n.scheduleAnnouncements(S),window.navigator.webdriver||(n.registerPresenter(b.default),n.scheduleAnnouncement(new f.default.SingleDevice({id:b.HOST_TOS_ANNOUNCEMENT_ID,campaignEndUtcDateTime:null,impressionPolicy:new T.AlwaysShowPolicy,choreographyInfo:{priority:c.Priority.LEGAL,groupInfo:{groupName:'aaa_global',sequenceOrder:1}}}))),(0,N.isUserConsentEnabled)()&&(n.registerPresenter(N.default),n.scheduleAnnouncement(new f.default.SingleDevice({id:N.USER_CONSENT_ANNOUNCEMENT_ID,campaignEndUtcDateTime:null,impressionPolicy:new T.AlwaysShowPolicy,choreographyInfo:{priority:c.Priority.LEGAL,groupInfo:{groupName:'aaa_global',sequenceOrder:2}}}))),(0,y.isGlobalBannerEnabled)()&&n.registerPresenter(y.default),(0,A.isTaskManagementFooterEnabled)()&&n.registerPresenter(A.default),n.registerPresenter(_.default),I&&n.scheduleAnnouncement((0,h.createPreviewAnnouncement)()),t||n.startPresentation()},[t,S]),(0,O.jsxs)(l.default,{children:[(0,O.jsx)(v.default,{}),(0,O.jsx)(P.default,{})]})};var s=r(d[2]),l=t(r(d[3])),o=r(d[4]),u=t(r(d[5])),c=r(d[6]),f=t(r(d[7])),p=t(r(d[8])),E=t(r(d[9])),P=t(r(d[10])),_=t(r(d[11])),h=r(d[12]),w=r(d[13]),v=t(r(d[14])),y=n(r(d[15])),A=n(r(d[16])),b=n(r(d[17])),N=n(r(d[18])),T=r(d[19]),O=r(d[20])},"620971",["45f788","ba7a76","07aa1f","d368ab","dcc72a","2c6bf9","af724a","068775","014366","379789","dd7619","0dd5ca","5b215d","4a39c9","7a7dcb","c57e59","eb25b6","20f028","ed263e","fc4d8f","b8c07d"]);
__d(function(g,r,i,a,m,e,d){"use strict";var n=r(d[0]).default;function t(){const n=r(d[1]);return t=function(){return n},n}Object.defineProperty(e,"__esModule",{value:!0}),e.useCanvasAnnouncementPreview=void 0;var u=n(r(d[2]));e.useCanvasAnnouncementPreview=({variables:n,skip:o})=>{const{data:s,loading:c,error:v,refetch:l}=(0,t().useClientSideQuery)(u.default,{variables:n,skip:o});return{data:s,error:v,loading:c,refetch:l}}},"653072",["ba7a76","068abc","f02099"]);
__d(function(g,r,i,a,m,e,d){"use strict";function t(){const n=r(d[0]);return t=function(){return n},n}Object.defineProperty(e,"__esModule",{value:!0}),e.naviAppTargets=void 0;const n=e.naviAppTargets={EXPERIENCE_HOST:'EXPERIENCE_HOST',GUEST:'GUEST',HOST:'HOST'};(0,t().getEnumObjectValidator)()(n)},"6a6f1f",["b4c559"]);
__d(function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.usePresenter=function(s){const{currentAnnouncement:o,markAsViewed:f,markAsComplete:l}=(0,u.useNaviState)(),A=(0,n.useRef)(o),[R,S]=(0,n.useState)(()=>c(s,o)),k=(0,n.useRef)(!1),_=(0,n.useRef)(!1);(0,n.useEffect)(()=>{c(s,o)?(S(!0),A.current=o):o&&o===A.current||(S(!1),k.current=!1,_.current=!1)},[o]);const p=()=>{c(s,o)&&!k.current&&A.current&&A.current===o&&(k.current=!0,f(A.current))},v=(n=t.PresentationResult.DISMISSED)=>{c(s,o)&&!_.current&&A.current&&A.current===o&&(_.current=!0,l(A.current,n))};return(0,n.useMemo)(()=>({shouldRender:R,content:A.current?.content,announcement:A.current,markAsViewed:p,markAsComplete:v}),[R])};var n=r(d[0]),t=r(d[1]),u=r(d[2]);function c(n,t){return!!t&&n.canHandleAnnouncement(t.id,t.content)}},"708bea",["07aa1f","af724a","9836eb"]);
__d(function(g,r,i,a,m,e,d){"use strict";var n=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(n){const y=(0,p.default)(),R=(0,t.useRef)(new Map),k=(n,t)=>{R.current.set(n,{id:n,presenters:new Set,announcements:new Map,dependencies:new Set(t),isReady:!1})},v=(0,t.useRef)(new Map),w=n=>{const t='string'==typeof n?n:(0,s.getAnnouncementKey)(n);return v.current.get(t)||(new l.default).resolve(!1)},A=n=>R.current.get(n),S=()=>[...R.current.values()],$=(n,t)=>{const c=A(n);if(!c)return;const s=new Set(t);(0,o.isEqualSet)(s,c.dependencies)||(c.dependencies=s,y(()=>[`Updating scope "${n}" dependencies:`,t]))},D=n=>{const t=A(n);t&&!t?.isReady&&(t.isReady=!0,y(()=>`Marking scope ${n} as ready`))},h=()=>f(c.GLOBAL_SCOPE_ID,R.current),E=n=>{const t=A(n);t&&(y(()=>`Removing scope ${n}`),R.current.delete(n),t.announcements.forEach(n=>{n.clearTimeout(),v.current.delete(n.announcement.key)}))},T=n=>{const t=A(n);t&&(y(()=>`Resetting scope ${n}`),t.isReady=!1,t.announcements.forEach(n=>{n.clearTimeout(),v.current.delete(n.announcement.key)}),t.announcements.clear(),t.presenters.clear())},M=(n,t)=>{A(t)?.presenters.has(n)||(y(()=>`Registering presenter: "${n}" -> ${t}`),A(t)?.presenters.add(n))},_=(n,t)=>{A(t)?.presenters.has(n)&&(y(()=>`Removing presenter: "${n}" -> ${t}`),A(t)?.presenters.delete(n))},P=()=>S().filter(n=>n.isReady).filter(n=>f(n.id,R.current)).map(n=>[...n.presenters]).flat(),U=(n,t)=>{const c=(0,s.coerceToFutureAnnouncement)(n),{announcement:u}=c,o=A(t);if(!o||o.announcements.has(u.key))return!1;if(u.campaignEndUtcDateTime&&new Date>new Date(u.campaignEndUtcDateTime))return y(()=>[`Skipping "${u.key}" due to expiration`,u]),w(u.key).resolve(!1),!1;o.announcements.set(u.key,c),y(()=>[`Scheduling announcement ${u.key} to scope ${t}`,u,o.announcements]);const p=new l.default;return v.current.set(u.key,p),!0},K=(n,t,c)=>{const s=A(t);if(!s)return;const o=(0,u.makeAnnouncementKey)(n,c);s.announcements.get(o)?.clearTimeout(),s.announcements.delete(o),v.current.delete(o)},O=()=>S().filter(n=>n.isReady).filter(n=>f(n.id,R.current)).map(n=>[...n.announcements.values()]).flat().filter(t=>{const c=t.announcement?.filterInfo?.pages;return!c?.length||n.current&&c.includes(n.current)}),b=()=>new Set(O().map(n=>n.announcement.key)),G=()=>{const n=O(),t=P();return n.filter(({announcement:n})=>!!t.find(t=>t.canHandleAnnouncement(n.id,n.content))).filter(({announcement:n})=>!n.campaignEndUtcDateTime||new Date(n.campaignEndUtcDateTime)>new Date)},I=(n,t)=>S().map(n=>[...n.announcements.values()]).flat().find(c=>c.announcement.key===(0,u.makeAnnouncementKey)(n,t));return(0,t.useMemo)(()=>({add:k,get:A,all:S,updateDependencies:$,remove:E,reset:T,ready:D,isGlobalReady:h,ref:R,registerPresenter:M,removePresenter:_,getReadyPresenters:P,addAnnouncement:U,removeAnnouncement:K,getReadyAnnouncements:O,getScheduledAnnouncementKeys:b,getSupportedAnnouncements:G,findAnnouncement:I,getAnnouncementResult:w}),[])};var t=r(d[1]),c=r(d[2]),s=r(d[3]),u=r(d[4]),o=r(d[5]),l=n(r(d[6])),p=n(r(d[7]));function f(n,t,c=new Set){const s=t.get(n);return!(!s||!s.isReady)&&(!!c.has(n)||(c.add(n),[...s.dependencies].every(n=>f(n,t,c))))}},"762889",["ba7a76","07aa1f","af724a","068775","f4362a","1a5f67","0af475","c809cd"]);
__d(function(g,r,i,a,m,e,d){"use strict";var n=r(d[0]).default,t=r(d[1]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){const n=(0,p.default)(c.GLOBAL_SCOPE_ID),{loading:t,announcements:y}=(0,_.default)({variables:{appTarget:c.AppTarget.GUEST},skip:!l.Flagger.isTrebuchetLaunched((0,o.default)('web.navi_server_announcements.guest'))}),N=(0,P.useIsCanvasPreviewEnabled)();return(0,u.useEffect)(()=>{!t&&y.length&&n.scheduleAnnouncements(y),(0,A.isUserConsentEnabled)()&&(n.registerPresenter(A.default),n.scheduleAnnouncement(new f.default.SingleDevice({id:A.USER_CONSENT_ANNOUNCEMENT_ID,campaignEndUtcDateTime:null,impressionPolicy:new b.AlwaysShowPolicy,choreographyInfo:{priority:c.Priority.LEGAL,groupInfo:{groupName:'aaa_global',sequenceOrder:1}}}))),n.registerPresenter(h.default),N&&n.scheduleAnnouncement((0,v.createPreviewAnnouncement)()),t||n.startPresentation()},[t,y]),(0,w.jsx)(s.default,{children:(0,w.jsx)(E.default,{})})};var u=r(d[2]),s=t(r(d[3])),l=r(d[4]),o=t(r(d[5])),c=r(d[6]),f=t(r(d[7])),p=t(r(d[8])),_=t(r(d[9])),E=t(r(d[10])),h=t(r(d[11])),v=r(d[12]),P=r(d[13]),A=n(r(d[14])),b=r(d[15]),w=r(d[16])},"77b657",["45f788","ba7a76","07aa1f","d368ab","dcc72a","2c6bf9","af724a","068775","014366","379789","dd7619","0dd5ca","5b215d","4a39c9","ed263e","fc4d8f","b8c07d"]);
__d(function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default,l=r(d[1]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){const{shouldRender:t}=(0,c.usePresenter)(o.default);return t?(0,h.jsx)(s.default,{children:(0,h.jsx)(n.default,{loader:j,renderPlaceholder:n.renderNull})}):null};var u=l(r(d[0])),n=t(r(d[2])),f=l(r(d[3])),s=l(r(d[4])),c=r(d[5]),o=l(r(d[6])),h=r(d[7]);const j=Object.assign((0,f.default)(()=>r(d[9])(d[8]).then(u.default)),{prefetch:()=>r(d[9]).prefetch(d[8])})},"7a7dcb",["45f788","ba7a76","b96ee5","b4385c","d368ab","708bea","c57e59","b8c07d","40415e","057569"]);
__d(function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,e.useNaviInternalContext=function(){return(0,n.useContext)(o)};var n=r(d[0]);function t(){}const o=(0,n.createContext)({addScope:t,removeScope:t,resetScope:t,updateScopeDependencies:t,registerPresenter:t,removePresenter:t,scheduleAnnouncement:()=>Promise.resolve(!1),scheduleAnnouncements:()=>Promise.all([]),removeAnnouncement:t,findAnnouncement:()=>{},startPresentation:t,onPageEnter:t,onPageExit:t,resetPage:t});o.displayName='NaviInternalApiContext';e.default=o},"7b3437",["07aa1f"]);
__d(function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,s){const f=(0,u.useNaviInternalContext)(),c=(0,o.default)(t,s);return(0,n.useEffect)(()=>(f.onPageEnter(t),()=>f.onPageExit(t)),[t]),(0,n.useMemo)(()=>({...c,reset:()=>f.resetPage(t),remove:()=>f.onPageExit(t)}),[t])};var n=r(d[1]),u=r(d[2]),o=t(r(d[3]))},"834679",["ba7a76","07aa1f","7b3437","014366"]);
__d(function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NaviStateContext=void 0,e.useNaviState=function(){return(0,t.useContext)(n)};var t=r(d[0]);const n=e.NaviStateContext=(0,t.createContext)({currentAnnouncement:null,markAsViewed:()=>{},markAsComplete:()=>{}});n.displayName='NaviStateContext'},"9836eb",["07aa1f"]);
__d(function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default={name:'AnnouncementImpressionInfo',type:'query',operationId:'1fc7ebbfcc39bd532a9e5d40a585a65e09b7b95308f2a7e8f7d3bac6db63df43'}},"a6a446",[]);
__d(function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.jitneyId=function({id:t,discriminator:n},o){const s=n?`${t}.${n}`:t;if(o)return`${s.toLowerCase()}.${o.toLowerCase()}_navi`;return`${s.toLowerCase()}_navi`}},"a8aa8f",[]);
__d(function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Priority=e.PresentationResult=e.PresentationRestrictions=e.PRIORITY_RANK=e.OrchestrationState=e.NoConsentBehavior=e.NaviAnnouncementPages=e.GLOBAL_SCOPE_ID=e.AppTarget=e.AnnouncementShowState=void 0;var I=r(d[0]),E=r(d[1]);const O=e.AnnouncementShowState={SHOW:'SHOW',DROP:'DROP'},_=(e.PresentationResult={DISMISSED:'DISMISSED',ACTIONED:'ACTIONED',DISCARDED:'DISCARDED',SKIPPED:'SKIPPED',REMOVED:'REMOVED'},e.PresentationRestrictions={SHOW_ALWAYS:'SHOW_ALWAYS',SHOW_ONLY_IF_FIRST_IN_PAGE:'SHOW_ONLY_IF_FIRST_IN_PAGE',SHOW_ONLY_IF_FIRST_NON_SHOW_ALWAYS:'SHOW_ONLY_IF_FIRST_NON_SHOW_ALWAYS',SHOW_ALWAYS_AT_MOST_ONCE_PER_PAGE:'SHOW_ALWAYS_AT_MOST_ONCE_PER_PAGE'},e.Priority={POISON_PILL:'POISON_PILL',CRITICAL:'POISON_PILL',LEGAL:'LEGAL',HIGH:'LEGAL',INTERACTIVE:'INTERACTIVE',TIME_SENSITIVE_REQUIRED_ACTION:'TIME_SENSITIVE_REQUIRED_ACTION',REGULAR:'TIME_SENSITIVE_REQUIRED_ACTION',MARKETING_EDUCATIONAL:'MARKETING_EDUCATIONAL',LOW:'MARKETING_EDUCATIONAL',CELEBRATION_RECOGNITION:'CELEBRATION_RECOGNITION',VERY_LOW:'CELEBRATION_RECOGNITION'});e.PRIORITY_RANK=Object.freeze([_.POISON_PILL,_.LEGAL,_.INTERACTIVE,_.TIME_SENSITIVE_REQUIRED_ACTION,_.MARKETING_EDUCATIONAL,_.CELEBRATION_RECOGNITION]),e.OrchestrationState={SETUP:0,ACTIVE:1,WAITING:2},e.NaviAnnouncementPages=I.naviAnnouncementPages,e.GLOBAL_SCOPE_ID='GLOBAL_SCOPE_ID',e.AppTarget=E.naviAppTargets,e.NoConsentBehavior={SHOW:O.SHOW,DROP:O.DROP}},"af724a",["fd3d5f","6a6f1f"]);
__d(function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getEnumObjectValidator=function(){return t=>{}}},"b4c559",[]);
__d(function(g,r,i,a,m,e,d){"use strict";var n=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.isGlobalBannerEnabled=e.default=void 0;var l=r(d[1]),t=n(r(d[2])),o=n(r(d[3]));e.isGlobalBannerEnabled=()=>l.Flagger.isTrebuchetLaunched((0,t.default)('navi_migration.host_global_banner.launch.web'));const u=new o.default((n,l)=>"HOST_GLOBAL_BANNER"===n||'HostGlobalBannerContent'===l?.__typename);e.default=u},"c57e59",["ba7a76","dcc72a","2c6bf9","cee790"]);
__d(function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default={name:'NaviServerAnnouncementsQuery',type:'query',operationId:'ca18b1006f49ca58f265e6eb397176384e0974bb6b071b64a07879fc3546b057',normalizedItemsLocators:[{keyPath:'id',itemsLocation:[{typeCondition:['Query'],responseKey:'presentation'},{typeCondition:['RootPresentationContainer'],responseKey:'naviAnnouncements'},{typeCondition:['NaviAnnouncement'],responseKey:'content'},{typeCondition:['TaskManagementFooter'],responseKey:'task'},{typeCondition:['RequiredTask'],responseKey:'action'}]},{keyPath:'id',itemsLocation:[{typeCondition:['Query'],responseKey:'presentation'},{typeCondition:['RootPresentationContainer'],responseKey:'naviAnnouncements'},{typeCondition:['NaviAnnouncement'],responseKey:'content'},{typeCondition:['TaskManagementFooter'],responseKey:'task'},{typeCondition:['RequiredTask'],responseKey:'listing'}],parameterizedFields:[{fieldResponsePath:[{typeCondition:['StaySupplyListing'],responseKey:'descriptions'},{typeCondition:['StaySupplyListingDescriptions'],responseKey:'descriptionByTypeAndLanguage'}],inputs:[{name:'descriptionType',value:'NAME'}]},{fieldResponsePath:[{typeCondition:['StaySupplyListing'],responseKey:'descriptions'},{typeCondition:['StaySupplyListingDescriptions'],responseKey:'descriptionsForTask'}],inputs:[{name:'descriptionTypes',value:'NAME'},{name:'perferredLanguageOption',value:'LOAD_DEFAULT'}]},{fieldResponsePath:[{typeCondition:['ActivityListing'],responseKey:'media'},{typeCondition:['ActivityListingMedia'],responseKey:'displayableHostMedia'}],inputs:[{name:'first',value:'3'}]}]},{keyPath:'id',itemsLocation:[{typeCondition:['Query'],responseKey:'presentation'},{typeCondition:['RootPresentationContainer'],responseKey:'naviAnnouncements'},{typeCondition:['NaviAnnouncement'],responseKey:'content'},{typeCondition:['TaskManagementFooter'],responseKey:'task'},{typeCondition:['WaitingRoom'],responseKey:'topLevelTask'},{typeCondition:['RequiredTask'],responseKey:'action'}]},{keyPath:'id',itemsLocation:[{typeCondition:['Query'],responseKey:'presentation'},{typeCondition:['RootPresentationContainer'],responseKey:'naviAnnouncements'},{typeCondition:['NaviAnnouncement'],responseKey:'content'},{typeCondition:['TaskManagementFooter'],responseKey:'task'},{typeCondition:['WaitingRoom'],responseKey:'topLevelTask'},{typeCondition:['RequiredTask'],responseKey:'listing'}],parameterizedFields:[{fieldResponsePath:[{typeCondition:['StaySupplyListing'],responseKey:'descriptions'},{typeCondition:['StaySupplyListingDescriptions'],responseKey:'descriptionByTypeAndLanguage'}],inputs:[{name:'descriptionType',value:'NAME'}]},{fieldResponsePath:[{typeCondition:['StaySupplyListing'],responseKey:'descriptions'},{typeCondition:['StaySupplyListingDescriptions'],responseKey:'descriptionsForTask'}],inputs:[{name:'descriptionTypes',value:'NAME'},{name:'perferredLanguageOption',value:'LOAD_DEFAULT'}]},{fieldResponsePath:[{typeCondition:['ActivityListing'],responseKey:'media'},{typeCondition:['ActivityListingMedia'],responseKey:'displayableHostMedia'}],inputs:[{name:'first',value:'3'}]}]},{keyPath:'id',itemsLocation:[{typeCondition:['Query'],responseKey:'presentation'},{typeCondition:['RootPresentationContainer'],responseKey:'naviAnnouncements'},{typeCondition:['NaviAnnouncement'],responseKey:'content'},{typeCondition:['TaskManagementFooter'],responseKey:'task'},{typeCondition:['WaitingRoom'],responseKey:'actions'}]}]}},"c6ac87",[]);
__d(function(g,r,i,a,m,e,d){"use strict";var n=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(n,s){const l=(0,c.default)('FutureAnnouncement'),{findAnnouncement:f}=(0,u.useNaviInternalContext)(),y=f(n,s),v=o(t=>{l(()=>`FutureAnnouncement(${n}).ready()`),y?.ready(t)}),x=o(()=>{l(()=>`FutureAnnouncement(${n}).cancel()`),y?.cancel()});return(0,t.useMemo)(()=>({exists:!!y,announcement:y?.announcement,ready:t=>{y?v(t):l(()=>`"${n}" does not exist yet`)},cancel:()=>{y?x():l(()=>`"${n}" does not exist yet`)}}),[y,v,x])};var t=r(d[1]),u=r(d[2]),c=n(r(d[3]));function o(n){const u=(0,t.useRef)(!1);return(0,t.useCallback)(t=>{if(!u.current)return u.current=!0,n(t)},[n])}},"c7e43f",["ba7a76","07aa1f","7b3437","c809cd"]);
__d(function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t="Navi"){return(0,u.useDebugLogger)(t)};var u=r(d[0])},"c809cd",["f8ea9a"]);
__d(function(g,r,i,a,m,_e,d){"use strict";Object.defineProperty(_e,"__esModule",{value:!0}),_e.default=void 0;_e.default=class{constructor(t){this.matcher=void 0,this.matcher=t}canHandleAnnouncement(t,e){if('string'==typeof this.matcher)return t===this.matcher;try{return this.matcher(t,e)}catch(t){return!1}}toString(){return`${this.matcher}`}}},"cee790",[]);
__d(function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default,n=r(d[1]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){(0,h.useCanvasAnnouncementInProductPreview)();const{shouldRender:t}=(0,f.usePresenter)(o.default);return t?(0,v.jsx)(c.default,{children:(0,v.jsx)(l.default,{loader:P,renderPlaceholder:l.renderNull})}):null};var u=n(r(d[0])),l=t(r(d[2])),s=n(r(d[3])),c=n(r(d[4])),f=r(d[5]),o=n(r(d[6])),h=r(d[7]),v=r(d[8]);const P=Object.assign((0,s.default)(()=>r(d[10])(d[9]).then(u.default)),{prefetch:()=>r(d[10]).prefetch(d[9])})},"dd7619",["45f788","ba7a76","b96ee5","b4385c","d368ab","708bea","0dd5ca","45b5b2","b8c07d","1c0f93","057569"]);
__d(function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.isTaskManagementFooterEnabled=e.default=void 0;var n=r(d[1]),l=r(d[2]),s=t(r(d[3]));e.isTaskManagementFooterEnabled=()=>(0,l.isTaskSystemEnabled)({flagger:n.Flagger});const o=new s.default('HOST_TASK_MANAGER');e.default=o},"eb25b6",["ba7a76","dcc72a","63aa08","cee790"]);
__d(function(g,r,i,a,m,e,d){"use strict";var N=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.isUserConsentEnabled=e.default=e.USER_CONSENT_ANNOUNCEMENT_ID=void 0;var n=r(d[1]),t=N(r(d[2])),_=N(r(d[3]));e.isUserConsentEnabled=()=>n.Flagger.isTrebuchetLaunched((0,t.default)('navi_migration.consento_modals.launch.web'));const E=e.USER_CONSENT_ANNOUNCEMENT_ID='USER_CONSENT_ANNOUNCEMENT_ID',s=new _.default(E);e.default=s},"ed263e",["ba7a76","dcc72a","2c6bf9","cee790"]);
__d(function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default={name:'CanvasAnnouncementOperation',type:'query',operationId:'c6806ec2ccf21a635d741ac52f771e2a15f986db40491045201131d420d12cf0'}},"f02099",[]);
__d(function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.makeAnnouncementKey=e.default=e.SingleDeviceAnnouncement=e.CoolOffUnit=e.CoolOffTime=void 0;var t=r(d[0]);const o=(t,o)=>o?`${t}.${o}`:t;e.makeAnnouncementKey=o;const n=e.CoolOffUnit={MILLISECONDS:'MILLISECONDS',SECONDS:'SECONDS',MINUTES:'MINUTES',HOURS:'HOURS',DAYS:'DAYS',MONTHS:'MONTHS',YEARS:'YEARS'};e.CoolOffTime=Object.freeze({milliseconds:t=>({timeUnit:n.MILLISECONDS,value:t}),seconds:t=>({timeUnit:n.SECONDS,value:t}),minutes:t=>({timeUnit:n.MINUTES,value:t}),hours:t=>({timeUnit:n.HOURS,value:t}),days:t=>({timeUnit:n.DAYS,value:t}),months:t=>({timeUnit:n.MONTHS,value:t}),years:t=>({timeUnit:n.YEARS,value:t})});class s{constructor({id:n,discriminator:s,campaignEndUtcDateTime:h,choreographyInfo:c,content:S,filterInfo:l,impressionPolicy:v,noConsentBehavior:f,presentationResult:u,showState:I}){this.id=void 0,this.discriminator=void 0,this.key=void 0,this.campaignEndUtcDateTime=void 0,this.choreographyInfo=void 0,this.content=void 0,this.filterInfo=void 0,this.impressionPolicy=void 0,this.noConsentBehavior=void 0,this.presentationResult=void 0,this.showState=void 0,this.id=n,this.discriminator=s,this.campaignEndUtcDateTime=h,this.choreographyInfo=c,this.content=S,this.filterInfo=l,this.impressionPolicy=v,this.presentationResult=u,this.showState=I,this.choreographyInfo.presentationRestriction||(this.choreographyInfo.presentationRestriction=this.choreographyInfo.priority===t.Priority.POISON_PILL||this.choreographyInfo.priority===t.Priority.LEGAL||this.choreographyInfo.priority===t.Priority.INTERACTIVE?t.PresentationRestrictions.SHOW_ALWAYS:t.PresentationRestrictions.SHOW_ONLY_IF_FIRST_IN_PAGE),this.noConsentBehavior=f||t.NoConsentBehavior.DROP,this.key=o(this.id,this.discriminator)}}class h extends s{constructor(t){super(t),this.id=void 0,this.id=t.id}}e.SingleDeviceAnnouncement=h;class c extends s{constructor(t){super(t),this.id=void 0,this.id=t.id}}e.default=c,c.SingleDevice=h},"f4362a",["af724a"]);
__d(function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CappedImpressionWithExpirationPolicy=e.CappedImpressionWithExpirationAndMaxCapPolicy=e.CappedImpressionPolicy=e.AlwaysShowPolicy=void 0;e.AlwaysShowPolicy=class{constructor({forceDiscard:o,localCoolOff:s}={}){this.forceDiscard=void 0,this.forceShow=void 0,this.localCoolOff=void 0,this.forceDiscard=o,this.forceShow=!0,this.localCoolOff=s}};e.CappedImpressionPolicy=class{constructor({forceDiscard:o,forceShow:s,maxCap:c,localCoolOff:t}){this.forceDiscard=void 0,this.forceShow=void 0,this.maxCap=void 0,this.localCoolOff=void 0,this.forceDiscard=o,this.forceShow=s,this.maxCap=c,this.localCoolOff=t}};e.CappedImpressionWithExpirationPolicy=class{constructor({forceDiscard:o,forceShow:s,maxCap:c,impressionExpirationUtcDateTime:t,localCoolOff:l}){this.forceDiscard=void 0,this.forceShow=void 0,this.maxCap=void 0,this.impressionExpirationUtcDateTime=void 0,this.localCoolOff=void 0,this.forceDiscard=o,this.forceShow=s,this.maxCap=c,this.impressionExpirationUtcDateTime=t,this.localCoolOff=l}};e.CappedImpressionWithExpirationAndMaxCapPolicy=class{constructor({forceDiscard:o,forceShow:s,maxCap:c,impressionExpirationUtcDateTime:t,localCoolOff:l}){this.forceDiscard=void 0,this.forceShow=void 0,this.maxCap=void 0,this.impressionExpirationUtcDateTime=void 0,this.localCoolOff=void 0,this.forceDiscard=o,this.forceShow=s,this.maxCap=c,this.impressionExpirationUtcDateTime=t,this.localCoolOff=l}}},"fc4d8f",[]);
__d(function(g,r,i,a,m,e,d){"use strict";function E(){const S=r(d[0]);return E=function(){return S},S}Object.defineProperty(e,"__esModule",{value:!0}),e.naviAnnouncementPages=void 0;const S=e.naviAnnouncementPages={CHECK_IN_METHOD_MANAGEMENT:'CHECK_IN_METHOD_MANAGEMENT',EARNINGS:'EARNINGS',EXPERIENCES_CALENDAR:'EXPERIENCES_CALENDAR',EXPERIENCES_DASHBOARD:'EXPERIENCES_DASHBOARD',EXPERIENCES_INSIGHTS:'EXPERIENCES_INSIGHTS',EXPERIENCES_PROFILE:'EXPERIENCES_PROFILE',GUEST_HOMEPAGE:'GUEST_HOMEPAGE',GUEST_PROFILE:'GUEST_PROFILE',HOST_RESERVATION_DETAILS:'HOST_RESERVATION_DETAILS',INBOX:'INBOX',INBOX_THREAD:'INBOX_THREAD',LOL:'LOL',MANAGE_QUICK_REPLIES:'MANAGE_QUICK_REPLIES',QUICK_REPLIES_EDITOR:'QUICK_REPLIES_EDITOR',RESERVATIONS_TAB:'RESERVATIONS_TAB',SEARCH_INPUT:'SEARCH_INPUT',SEARCH_RESULT:'SEARCH_RESULT',EXPERIENCES_SEARCH_RESULT:'EXPERIENCES_SEARCH_RESULT',SERVICES_SEARCH_RESULT:'SERVICES_SEARCH_RESULT',STAYS_CALENDAR:'STAYS_CALENDAR',STAYS_PROFILE:'STAYS_PROFILE',TODAY_TAB:'TODAY_TAB',TRIPS:'TRIPS',USER_PROFILE:'USER_PROFILE',WISHLISTS:'WISHLISTS',WISHLIST_DETAILS:'WISHLIST_DETAILS',EXPERIENCES_AND_SERVICES_CALENDAR:'EXPERIENCES_AND_SERVICES_CALENDAR'};(0,E().getEnumObjectValidator)()(S)},"fd3d5f",["b4c559"]);
__d(function(g,_r,i,a,m,e,d){"use strict";var n=_r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=function({children:n,app:b}){const k=(0,S.default)(),[T,C]=(0,t.useState)(null),N=(0,l.default)(T),w=(0,t.useRef)(A.OrchestrationState.SETUP),W=(0,t.useRef)(null),{getMatchedRoute:L}=(0,c.useAppRoutes)(),D=(0,R.default)(W),G=(0,P.default)(),M=(0,t.useRef)([]),x=(0,t.useCallback)(n=>n.choreographyInfo.presentationRestriction===A.PresentationRestrictions.SHOW_ONLY_IF_FIRST_IN_PAGE&&M.current.length>0||(!(n.choreographyInfo.presentationRestriction!==A.PresentationRestrictions.SHOW_ONLY_IF_FIRST_NON_SHOW_ALWAYS||!M.current.some(n=>n.choreographyInfo.presentationRestriction!==A.PresentationRestrictions.SHOW_ALWAYS))||n.choreographyInfo.presentationRestriction===A.PresentationRestrictions.SHOW_ALWAYS_AT_MOST_ONCE_PER_PAGE&&M.current.some(t=>t.id===n.id&&t.discriminator===n.discriminator)),[]),F=(0,t.useCallback)(async n=>{for(const t of(0,O.default)(n)){const n=await G.shouldShowAnnouncement(t);if(t.showState=n,D.getScheduledAnnouncementKeys().has(t.key))if(n!==A.AnnouncementShowState.DROP){if(n===A.AnnouncementShowState.SHOW){if(x(t)){k(()=>['Suppressing announcement due to presentation restrictions',t]),D.getAnnouncementResult(t.key).resolve(!1);continue}return t}}else D.getAnnouncementResult(t.key).resolve(!1);else k(()=>`Skipping announcement "${t.key}", no longer scheduled`),D.getAnnouncementResult(t.key).resolve(!1)}},[]),K=n=>!(0,_.isEqualSet)(n,D.getScheduledAnnouncementKeys()),V=(0,t.useRef)(new AbortController),Y=(0,t.useCallback)(async({continuePresenting:n,overridePriorities:t}={continuePresenting:!1})=>{if(w.current===A.OrchestrationState.ACTIVE&&!n)return;w.current=A.OrchestrationState.ACTIVE,V.current.abort(),V.current=new AbortController;const{signal:r}=V.current,o=D.getScheduledAnnouncementKeys();k(()=>['Finding top announcement from:',o]);for(const n of t||A.PRIORITY_RANK){const s=D.getSupportedAnnouncements().filter(t=>t.announcement.choreographyInfo.priority===n);if(!s.length)continue;s.forEach(n=>n.startTimeout());const u=await Promise.allSettled(s.map(n=>n.promise));if(r.aborted)return;if(K(o))return k(()=>'New announcements scheduled during presentation, starting from the top'),Y({continuePresenting:!0,overridePriorities:t});const c=u.filter(n=>'fulfilled'===n.status).map(n=>n.value),l=await F(c);if(r.aborted)return;if(l)return k(()=>[`Presenting announcement: ${l.key}`,l]),void C(l)}if(K(o))return k(()=>'New announcements scheduled during presentation, starting from the top'),Y({continuePresenting:!0,overridePriorities:t});t?k(()=>'Ending presentation loop, nothing higher priority than current announcement'):(w.current=A.OrchestrationState.WAITING,k(()=>'Ending presentation loop, nothing to show, moving to WAITING state'))},[]),$=(0,t.useCallback)((n,t)=>{const r=D.addAnnouncement(n,t);return r&&G.startImpressionRequest(n),r&&D.get(t)?.isReady&&w.current===A.OrchestrationState.WAITING&&(k(()=>'New announcement scheduled during WAITING state, restarting presentation'),Y()),D.getAnnouncementResult(n)},[]),H=(0,t.useCallback)((n,t)=>(n.filter(n=>D.addAnnouncement(n,t))?.map(n=>G.startImpressionRequest(n)).length>0&&D.get(t)?.isReady&&w.current===A.OrchestrationState.WAITING&&(k(()=>'New announcements scheduled during WAITING state, restarting presentation'),Y()),Promise.all(n.map(n=>D.getAnnouncementResult(n)))),[]),U=(0,t.useCallback)(()=>N.current&&D.get(A.GLOBAL_SCOPE_ID)?.announcements.has(N.current.key),[]),j=(0,t.useCallback)(n=>{if(D.get(n)?.isReady)return;if(D.ready(n),w.current===A.OrchestrationState.ACTIVE&&!U())return;if(!D.isGlobalReady())return void k(()=>['Scope dependencies not yet satisfied:',D.all()]);if(!N.current)return k(()=>'All scope dependencies satisfied, starting presentation'),void Y();const{key:t,choreographyInfo:{priority:r}}=N.current,o=A.PRIORITY_RANK.slice(0,A.PRIORITY_RANK.indexOf(r));k(()=>`All scopes are ready, already presenting global announcement ${t}.Now checking for anything higher priority than ${r}`),Y({continuePresenting:!0,overridePriorities:o})},[]),q=(0,t.useCallback)(()=>{if(!U())return!1;const n=N.current?.filterInfo?.pages;if(!n||0===n?.length)return!0;if(W.current)return n?.includes(W.current);if(!W.current&&1===n?.length)return!1;let t;try{const n=L(window.location.pathname,{matchAll:!0}),r=(n||[])?.find(({match:n})=>n.isExact);t=r?.route?.options?.naviPage}catch(n){}return t&&n?.includes(t)},[]),B=(0,t.useCallback)(()=>{V.current.abort(),G.clearRequestCache(),q()||(C(null),N.current=null,M.current=[],w.current=A.OrchestrationState.SETUP,k(()=>'Resetting orchestrator into SETUP'))},[]),J=(0,t.useCallback)(n=>{W.current=n,D.get(A.GLOBAL_SCOPE_ID)?.dependencies.add(n),w.current===A.OrchestrationState.WAITING&&(k(()=>'Resetting orchestrator into SETUP (onPageEnter)'),s.Flagger.isTrebuchetLaunched((0,u.default)('navi.web.scope_removal_cleanup'))?B():w.current=A.OrchestrationState.SETUP)},[]),z=(0,t.useCallback)(n=>{k(()=>'Exiting page'),D.get(A.GLOBAL_SCOPE_ID)?.dependencies.delete(n),D.remove(n),W.current=null,B()},[]),Q=(0,t.useCallback)(n=>{k(()=>'Resetting page'),D.reset(n),B()},[]),X=(0,t.useCallback)(n=>{G.recordImpression(n)},[]),Z=(0,t.useCallback)((n,t)=>{if(k(()=>`Marking ${n.key} as complete (${t})`),!D.findAnnouncement(n.id,n.discriminator))return void k(()=>`${n.key} parent scope already removed`);t!==A.PresentationResult.REMOVED&&t!==A.PresentationResult.SKIPPED&&(n.presentationResult=t);const s=t!==A.PresentationResult.DISCARDED&&t!==A.PresentationResult.SKIPPED;s&&(M.current.push(n),p.default.logJitneyEvent({schema:o().UniversalComponentActionEvent,event_data:{component:'NaviAnnouncement',logging_id:(0,y.jitneyId)(n,t),ancestor_logging_ids:[],ancestor_uuids:[],method:'dismissed',uuid:(0,r().v4)(),operation:9}})),C(null),D.getAnnouncementResult(n.key).resolve(s),w.current===A.OrchestrationState.ACTIVE&&queueMicrotask(()=>Y({continuePresenting:!0}))},[]),ee=(0,t.useMemo)(()=>({currentAnnouncement:T,markAsViewed:X,markAsComplete:Z}),[T]),ne=(0,t.useCallback)(n=>{!W.current&&N.current&&D.get(n)?.announcements.has(N.current.key)&&s.Flagger.isTrebuchetLaunched((0,u.default)('navi.web.scope_removal_cleanup'))&&(k(()=>`Announcement's scope (${n}) is being removed. Null'ing announcement.`),Z(N.current,A.PresentationResult.REMOVED)),D.remove(n)},[]),te=(0,t.useCallback)((n,t,r)=>{N.current?.id===n&&N.current?.discriminator===r&&Z(N.current,A.PresentationResult.REMOVED),D.removeAnnouncement(n,t,r)},[]),re=(0,t.useMemo)(()=>({addScope:D.add,removeScope:ne,resetScope:D.reset,updateScopeDependencies:D.updateDependencies,registerPresenter:D.registerPresenter,removePresenter:D.removePresenter,scheduleAnnouncement:$,scheduleAnnouncements:H,removeAnnouncement:te,findAnnouncement:D.findAnnouncement,startPresentation:j,onPageEnter:J,onPageExit:z,resetPage:Q}),[]);return(0,E.jsx)(I.default.Provider,{value:re,children:(0,E.jsxs)(v.NaviStateContext.Provider,{value:ee,children:[b===A.AppTarget.HOST&&s.Flagger.isTrebuchetLaunched((0,u.default)('navi_global_scope.host'))&&(0,E.jsx)(f.default,{}),b===A.AppTarget.GUEST&&s.Flagger.isTrebuchetLaunched((0,u.default)('navi_global_scope.guest'))&&(0,E.jsx)(h.default,{}),n]})})};var t=_r(d[1]);function r(){const n=_r(d[2]);return r=function(){return n},n}function o(){const n=_r(d[3]);return o=function(){return n},n}var s=_r(d[4]),u=n(_r(d[5])),c=_r(d[6]),l=n(_r(d[7])),p=n(_r(d[8])),h=n(_r(d[9])),f=n(_r(d[10])),A=_r(d[11]),S=n(_r(d[12])),P=n(_r(d[13])),R=n(_r(d[14])),I=n(_r(d[15])),v=_r(d[16]),_=_r(d[17]),y=_r(d[18]),O=n(_r(d[19])),E=_r(d[20])},"fd91b8",["ba7a76","07aa1f","305dd5","08dcd9","dcc72a","2c6bf9","2c12de","d18042","c8b97a","77b657","620971","af724a","c809cd","2b4782","762889","7b3437","9836eb","1a5f67","a8aa8f","53350f","b8c07d"]);
//# sourceMappingURL=https://sourcemaps.d.musta.ch/airbnb/static/packages/web/common/e051.339a509509.js.map